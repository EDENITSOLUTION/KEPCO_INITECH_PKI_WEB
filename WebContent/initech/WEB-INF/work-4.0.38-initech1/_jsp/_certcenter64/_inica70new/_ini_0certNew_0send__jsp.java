/*
 * JSP generated by Resin Professional 4.0.38 (built Tue, 17 Dec 2013 09:49:45 PST)
 */

package _jsp._certcenter64._inica70new;
import javax.servlet.*;
import javax.servlet.jsp.*;
import javax.servlet.http.*;
import java.util.*;
import java.io.*;
import java.text.*;
import java.security.MessageDigest;
import java.security.NoSuchAlgorithmException;
import java.sql.*;
import javax.sql.*;
import javax.naming.*;
import java.net.*;
import java.lang.*;
import java.security.cert.X509Certificate;
import com.initech.iniplugin.*;
import com.initech.oppra.*;
import com.initech.oppra.util.*;
import java.util.Date.*;
import java.lang.String.*;
import java.text.SimpleDateFormat;
import kepco.*;

public class _ini_0certNew_0send__jsp extends com.caucho.jsp.JavaPage
{
  private static final java.util.HashMap<String,java.lang.reflect.Method> _jsp_functionMap = new java.util.HashMap<String,java.lang.reflect.Method>();
  private boolean _caucho_isDead;
  private boolean _caucho_isNotModified;
  private com.caucho.jsp.PageManager _jsp_pageManager;


      public static String lpad(String str, int len, String addStr) {
           String result = str;
           if (result == null) return result;
           int templen   = len - result.length();

          for (int i = 0; i < templen; i++){
                 result = addStr + result;
           }
           
           return result;
       }


  
   public byte[] getHashValue(String inputString)
      {
          MessageDigest md = null;
          
          try {
              md = MessageDigest.getInstance("MD5");
              
              md.update(inputString.getBytes());
              
          } catch (NoSuchAlgorithmException e) {
              // TODO \uc790\ub3d9 \uc0dd\uc131\ub41c catch \ube14\ub85d
              e.printStackTrace();
          }
          
          return md.digest(); 
      }
  
      public String getBase64Data(byte[] inputByte) throws IOException
      {
          String returnString = "";
          returnString = new String(com.initech.util.Base64Util.encode(inputByte, false));
  
          return returnString;
      }
  



  public static String makeCertString(String varName, String certificate, boolean doFromJSP)
  {
  	String certificate1 = null;
  	String retString = null;
  	String certContent = null;

  	/*
  	   if( doFromJSP ){
  	   certContent = certificate.substring("-----BEGIN CERTIFICATE-----".length()+2, certificate.length() - ("-----END CERTIFICATE-----".length()+2));
  	   }else{
  	   certContent = certificate.substring("-----BEGIN CERTIFICATE-----".length(), certificate.length() - ("-----END CERTIFICATE-----".length() + 1 ));
  	   }
  	 */

  	certificate = certificate.replace("-----BEGIN CERTIFICATE-----", "");
  	certContent = certificate.replace("-----END CERTIFICATE-----", "");


  	StringTokenizer token = new StringTokenizer(certContent, "\n\r");

  	while(token.hasMoreTokens()) {
  		String temp = token.nextToken();
  		if(certificate1 == null) {
  			certificate1 = temp;
  		} else if(certificate1.equals(null)) {
  			System.out.println("Second Null");
  		} else {
  			certificate1 = certificate1 + temp;
  		}
  	}

  	retString = varName + "=\"-----BEGIN CERTIFICATE-----\";\n" + varName + "+=\"\\n\";\n";

  	StringReader reader = new StringReader(certificate1);

  	char[] readbuf = new char[64];
  	try {
  		for(int i = 0; i < (int)Math.floor((certificate1.length() / 64)); i++) {
  			reader.read(readbuf);
  			String temp = varName + "+=\"" + new String(readbuf) + "\";\n";
  			temp = temp + varName + "+=\"\\n\";\n";
  			retString = retString + temp;
  		}

  		int rem = certificate1.length() % 64;
  		if( rem != 0) {
  			System.out.println("rem length : " + String.valueOf(rem));
  			char[] buf = new char[rem];
  			reader.read(buf);
  			String temp = varName + "+=\"" + new String(buf) + "\";\n";

  			temp = temp + varName + "+=\"\\n\";\n";
  			retString = retString + temp;
  		}

  	} catch (Exception e) {
  		System.out.println("Exception e");
  		e.printStackTrace();
  	}

  	String temp = varName + "+=\"-----END CERTIFICATE-----\";\n";
  	retString = retString + temp;

  	return retString;
  }

  public static String makeCertCSString(String certificate)
  {
  	String certificate1 = null;
  	String retString = null;
  	String certContent = null;

  	certificate = certificate.replace("-----BEGIN CERTIFICATE-----", "");
  	certContent = certificate.replace("-----END CERTIFICATE-----", "");

  	return certContent;
  }
  /*
  public static String makeCertCSString(String certificate)
  {
  	String certificate1 = null;
  	String retString = null;
  	String certContent = null;

  	certificate = certificate.replace("-----BEGIN CERTIFICATE-----", "");
  	certContent = certificate.replace("-----END CERTIFICATE-----", "");

  	StringTokenizer token = new StringTokenizer(certContent, "\n\r");

  	while(token.hasMoreTokens()) {
  		String temp = token.nextToken();
  		if(certificate1 == null) {
  			certificate1 = temp;
  		} else if(certificate1.equals(null)) {
  			System.out.println("Second Null");
  		} else {
  			certificate1 = certificate1 + temp;
  		}
  	}

  	retString = "-----BEGIN CERTIFICATE-----\n\r";

  	StringReader reader = new StringReader(certificate1);

  	char[] readbuf = new char[64];
  	try {
  		for(int i = 0; i < (int)Math.floor((certificate1.length() / 64)); i++) {
  			reader.read(readbuf);
  			String temp = new String(readbuf) + "\n\r";
  			retString = retString + temp;
  		}

  		int rem = certificate1.length() % 64;
  		if( rem != 0) {
  			System.out.println("rem length : " + String.valueOf(rem));
  			char[] buf = new char[rem];
  			reader.read(buf);
  			String temp = new String(buf) + "\n\r";
  			retString = retString + temp;
  		}

  	} catch (Exception e) {
  		System.out.println("Exception e");
  		e.printStackTrace();
  	}

  	String temp = "-----END CERTIFICATE-----\n\r";
  	retString = retString + temp;

  	return retString;
  }*/



   public String sendSMS(String strCertGb, String userId, String strTmid) {

          String resultCd = null ; //\uacb0\uacfc\ucf54\ub4dc
          int cnt_user = 0 ; //\uc0ac\uc6a9\uc790 \uc874\uc7ac \uc720\ubb34
          int cnt_log_user = 0 ; //\uc778\uc99d\uc11c\ubc1c\uae09\uc2dc \uc0ac\uc6a9\uc790 \uc874\uc7ac \uc720\ubb34
          String userName = null ; //\uc0ac\uc6a9\uc790\uba85
          String userPhone = null ; //\uc0ac\uc6a9\uc790 \uc804\ud654\ubc88\ud638
          String userMail = null ; //\uc0ac\uc6a9\uc790 \uc774\uba54\uc77c

          String strMyPhoneNum = null;
          String strMyRefPhoneNum = null;

          String strMsgText = null; //SMS\ubc1c\uc1a1\uba54\uc138\uc9c0
          String strMsgText1 = null;
          String strMakingText = null;
          String strMakingText1 = null;
          String REFPHONE = null ;

          String userTmid = "";
          String userSmsSeq = "";

          String SENDIP = "203.248.44.150";
          int SENDPORT = 7904;
          ////////////////////////////////////////////////////
          //\uc218\uc2e0 \ucf54\ub4dc ///////////////////////////////////
          String RETURNCODE = "2000";
          String RETURNMSG = "" ;

          //\uc778\uc99d\uc11c\ubc1c\uae09\uc2dc SMS\ub85c\uadf8 \uc815\ubcf4
          String strSeq = "";
          String strUserid ="";
          String strUserip = "";
          String strCrdate = "";
          String strSmsnum = "";
          String strRetcode = "";
          String strUserphone = "";
          String strRefuserid = "";



          try{
                  //step1. userId\ub85c \uc0ac\uc6a9\uc790 \uc815\ubcf4 \uc870\ud68c
                  Context ctSms = new InitialContext();
                  DataSource dsSms = (DataSource) ctSms.lookup("java:comp/env/jdbc/USERS");
                  ResultSet rsSms = null;
                  Connection conSms = null;
                  Statement stmtSms = null;
                  String smsQry = null;

                  //\uc0ac\ubc88\uc774 \uc778\uc0ac\uc815\ubcf4\uc5d0 \uc874\uc7ac\ud558\ub294\uc9c0 \uccb4\ud06c
                  conSms = dsSms.getConnection();
                  //Creat Query and get results
                  stmtSms = conSms.createStatement();

                  rsSms = stmtSms.executeQuery("SELECT COUNT(*) as cnt FROM V_INSA WHERE EMPNO ='"+ userId +"'");
                  while (rsSms.next()){
                          cnt_user = rsSms.getInt("cnt");
                  }
                  if (cnt_user == 0){
                          resultCd = "SEND-NO";
                  }else{ // \uc0ac\uc6a9\uc790 \uc815\ubcf4 \uc874\uc7ac\ud560\ub54c
                          smsQry = "" ;
                          smsQry = smsQry + "SELECT "; 
                          smsQry = smsQry + "             X.EMPNO ";
                          smsQry = smsQry + "     ,       X.USER_NAME ";
                          smsQry = smsQry + "     ,   X.CELLNO ";
                          smsQry = smsQry + "     ,       X.VAL1 ";
                          smsQry = smsQry + "     ,       X.VAL2 ";
                          smsQry = smsQry + "     ,( ";
                          smsQry = smsQry + "             CASE WHEN X.VAL1 = 'ok' THEN X.CELLNO ";
                          smsQry = smsQry + "             ELSE ";
                          smsQry = smsQry + "                     CASE WHEN X.VAL2 = 'ok' THEN  ";
                          smsQry = smsQry + "                             CASE WHEN LENGTH(X.CELLNO) = 10 THEN ";
                          smsQry = smsQry + "                                     SUBSTR(X.CELLNO,1,3) || '-' || SUBSTR(X.CELLNO,4,3) ";
                          smsQry = smsQry + "                                     || '-' || SUBSTR(X.CELLNO,7,4) ";
                          smsQry = smsQry + "                             ELSE ";
                          smsQry = smsQry + "                                     SUBSTR(X.CELLNO,1,3) || '-' || SUBSTR(X.CELLNO,4,4) ";
                          smsQry = smsQry + "                                     || '-' || SUBSTR(X.CELLNO,8,4) ";
                          smsQry = smsQry + "                             END ";
                          smsQry = smsQry + "                     ELSE 'x' ";
                          smsQry = smsQry + "                     END ";
                          smsQry = smsQry + "             END ";
                          smsQry = smsQry + "     ) AS PHONENUM ";
                          smsQry = smsQry + "     , X.MAILADDR ";
                          smsQry = smsQry + " FROM ( ";
                          smsQry = smsQry + "     SELECT ";
                          smsQry = smsQry + "             EMPNO ";
                          smsQry = smsQry + "             , NAME AS USER_NAME ";
                          smsQry = smsQry + "             , CELLNO ";
                          smsQry = smsQry + "             , DECODE ( ";
                          smsQry = smsQry + "                     REGEXP_REPLACE(  ";
                          smsQry = smsQry + "                             REGEXP_SUBSTR(  ";
                          smsQry = smsQry + "                                     CELLNO,  ";
                          smsQry = smsQry + "                                     '01[0-9]{1}-[0-9]{3,4}-[0-9]{4}',  ";
                          smsQry = smsQry + "                                     1 ";
                          smsQry = smsQry + "                             ), '[^0-9]', '-' ";
                          smsQry = smsQry + "                     )  ";
                          smsQry = smsQry + "             , '','x','ok') VAL1  ";
                          smsQry = smsQry + "             , DECODE ( ";
                          smsQry = smsQry + "                     REGEXP_REPLACE(  ";
                          smsQry = smsQry + "                             REGEXP_SUBSTR(  ";
                          smsQry = smsQry + "                                     CELLNO,  ";
                          smsQry = smsQry + "                                     '01[0-9]{1}[0-9]{7,8}',  ";
                          smsQry = smsQry + "                                     1 ";
                          smsQry = smsQry + "                             ), '[^0-9]', '-' ";
                          smsQry = smsQry + "                     )  ";
                          smsQry = smsQry + "             , '','x','ok') VAL2 ";
                          smsQry = smsQry + "    , MAILNO ";
                          smsQry = smsQry + "                      ,( ";
                          smsQry = smsQry + "    CASE WHEN MAILNO IS NULL THEN 'x' ";
                          smsQry = smsQry + "    ELSE ";
                          smsQry = smsQry + "             CASE INSTR(MAILNO,'@',1)  ";
                          smsQry = smsQry + "                     WHEN 0 THEN MAILNO || '@kepco.co.kr' ";
                          smsQry = smsQry + "       ELSE MAILNO ";
                          smsQry = smsQry + "       END ";
                          smsQry = smsQry + "     END ";
                          smsQry = smsQry + "    ) AS MAILADDR ";
                          smsQry = smsQry + "     FROM  V_INSA ";
                          smsQry = smsQry + "     WHERE EMPNO = '"+ userId +"' ";
                          smsQry = smsQry + ") X ";


                          rsSms = stmtSms.executeQuery(smsQry);

                          while (rsSms.next()){
                                  userMail = rsSms.getString("MAILADDR");
                                  userPhone = rsSms.getString("PHONENUM").replace("-","");
                                  userName = rsSms.getString("USER_NAME");
                          }
                          resultCd = "SEND-YES";

                          strMyPhoneNum = userPhone ;//("01099117557" 15 + 1) 
                          strMyRefPhoneNum = userPhone;

                          //RECVPHONE = userPhone ;//("01099117557" 15 + 1) 
                          //REFPHONE = userPhone;

                          cnt_user = 1;
                  }

                  rsSms.close();
                  stmtSms.close();
                  conSms.close();

          }
          catch(Exception ex){
                  ex.printStackTrace();
          } finally {
          }
          if (resultCd.equals("SEND-YES")) {

                  //SMS\ubc1c\uc1a1\uc744 \uc704\ud55c \ud074\ub77c\uc774\uc5b8\ud2b8 \uac1d\uccb4 \uc0dd\uc131
                  SmsClient sms = new SmsClient();

                  if (strCertGb.equals("certNew")){ //\uc778\uc99d\uc11c \ubc1c\uae09 \ud6c4
                          userTmid = strTmid;
                          userSmsSeq = userTmid + "_" + userId ;// + "_" + request.getRemoteAddr() ; // 20140709172427_ex099129_255.255.255.255;

                          try{
                                  Context ctNew = new InitialContext();
                                  DataSource dsNew = (DataSource) ctNew.lookup("java:comp/env/jdbc/USERS");
                                  ResultSet rsNew = null;
                                  Connection conNew = null;
                                  Statement stmtNew = null;
                                  String newQry = null;
                                  String newQry1 = null;
                                  newQry = "select count(*) as cnt from sms_log where seq like '"+ userSmsSeq +"%'";
                                  newQry1 = "select seq, userid, userip, crdate, smsnum, retcode, userphone,refuserid ";
                                  newQry1 = newQry1 + " from sms_log where seq like '"+ userSmsSeq +"%'";

                                  conNew = dsNew.getConnection();
                                  //Creat Query and get results
                                  stmtNew = conNew.createStatement();

                                  rsNew = stmtNew.executeQuery(newQry);
                                  while (rsNew.next()){
                                          cnt_log_user = rsNew.getInt("cnt");
                                  }
                                  if (cnt_log_user == 0){
                                          resultCd = "SEND-NO";
                                  }else{ // \uc0ac\uc6a9\uc790 \uc815\ubcf4 \uc874\uc7ac\ud560\ub54c
                                          rsNew = stmtNew.executeQuery(newQry1);
                                          while (rsNew.next()){
                                                  strSeq = rsNew.getString("seq");
                                                  strUserid = rsNew.getString("userid");
                                                  strUserip = rsNew.getString("userip");
                                                  strCrdate = rsNew.getString("crdate");
                                                  strRetcode = rsNew.getString("retcode");
                                                  strSmsnum = rsNew.getString("smsnum");
                                                  strUserphone = rsNew.getString("userphone");
                                                  strRefuserid = rsNew.getString("refuserid");
                                          }
                                          resultCd = "SEND-YES";

                                          if (strUserid.trim().equals(strRefuserid.trim())){
                                                  strMsgText = "[\ud55c\uc804 \uc778\ud130\ub137\ub9dd]" + userName + "("+ userId +")\ub2d8\uc758 \uc778\uc99d\uc11c \ubc1c\uae09\uc774 \uc644\ub8cc\ub418\uc5c8\uc2b5\ub2c8\ub2e4.";
                                                  strMsgText1 = strMsgText;
                                                  strMakingText = Make_SMS_MSG(strMyPhoneNum, strMsgText, userId);
                                                  strMakingText1 = strMakingText;
                                          }
                                          else{
                                                  strMsgText = "[\ud55c\uc804 \uc778\ud130\ub137\ub9dd]" + userName + "("+ userId +")\ub2d8\uc758 \uc778\uc99d\uc11c \ub300\ub9ac\ubc1c\uae09\uc774 \uc644\ub8cc\ub418\uc5c8\uc2b5\ub2c8\ub2e4.";
                                                  strMsgText1 = "[\ud55c\uc804 \uc778\ud130\ub137\ub9dd]" + userName + "("+ userId +")\ub2d8\uc758 \uc778\uc99d\uc11c \ub300\ub9ac\ubc1c\uae09\uc774 \uc644\ub8cc\ub418\uc5c8\uc2b5\ub2c8\ub2e4.";
                                                  strMakingText = Make_SMS_MSG(strMyPhoneNum, strMsgText, userId);
                                                  strMakingText1 = Make_SMS_MSG(getRefUserPhone(strRefuserid), strMsgText1, strRefuserid);


                                          }
                                          
                                          cnt_log_user = 1;
                                  }


                                  rsNew.close();
                                  stmtNew.close();
                                  conNew.close();
                          }
                          catch(Exception ex){
                                  ex.printStackTrace();
                          } finally {
                          }

                  } //\ubc1c\uae09 end
                  else{//\uc778\uc99d\uc11c \ud3d0\uae30\ud6c4 certRevoke
                          userTmid = "";
                          userSmsSeq = "";
                          strMsgText = "[\ud55c\uc804 \uc778\ud130\ub137\ub9dd]" + userName + "("+ userId +")\ub2d8\uc758 \uc778\uc99d\uc11c \ud3d0\uae30\uac00 \uc644\ub8cc\ub418\uc5c8\uc2b5\ub2c8\ub2e4.";
                          strMakingText = Make_SMS_MSG(strMyPhoneNum, strMsgText, userId);

                  }//\ud3d0\uae30 end

                  RETURNCODE = sms.SendSMS(SENDIP, SENDPORT, strMakingText);
                  RETURNCODE = RETURNCODE.trim();
                  RETURNMSG = rtnMessage(RETURNCODE);

                  if (strUserid.trim().equals(strRefuserid.trim())){
                  }else{
                          RETURNCODE = sms.SendSMS(SENDIP, SENDPORT, strMakingText1);
                           RETURNCODE = RETURNCODE.trim();
                           RETURNMSG = rtnMessage(RETURNCODE);
                  }

                  resultCd = RETURNCODE;

          }
          
      return resultCd ; 
      
  }


  public String fillSpace(String text, int size){
          String tmpStr = "";
          try{ 
                  tmpStr = new String(text.getBytes("KSC5601"),"8859_1"); 
          }catch(UnsupportedEncodingException e){
                  e.printStackTrace(); 
          } 
          int diff = size - tmpStr.length();
          if (diff > 0 ){
                  for (int i = 0 ; i < diff ; i++) {
                          text += " ";
                          //text +=  (char)0;
                  }
                  StringBuffer sb1 = new StringBuffer(text);
                  sb1.setLength(size);
                  text = sb1.toString();
          }
          else{
                  StringBuffer sb = new StringBuffer(text);
                  sb.setLength(size);
                  text = sb.toString();
          }

          return text;
  }

  public String getMessage(String str, int addCnt) {
          String strAdd ="";
          for(int i=0; i <addCnt ; i++){
                  strAdd += " ";
          }
          return str+strAdd;
  }

  public String Make_SMS_MSG(String strRecvPhone, String strSmsMsg, String strEmpNo){
          String SmsMsgStr = null;

          int iCLASSCODE = 5 ;//--
          String CLASSCODE = "IDMKL" ; // 5 + 1 //--
          int iPASSWORD = 4 ;//--
          String PASSWORD = "DIST"; // 4 + 1 //--
          int iKEY = 15 ;//--
          String KEY = "000000000000001";//15 + 1 //--
          Locale locale = java.util.Locale.KOREA; //--
          SimpleDateFormat sdfr = new SimpleDateFormat("yyyyMMddHHmmss", locale); //--
          String convertedTime = sdfr.format(new java.util.Date()); //--
          KEY = convertedTime ;    //--
          int iRECVPHONE = 15 ;//--
          String RECVPHONE = strRecvPhone ; //--
          int iCALLBACK = 15 ;//--
          String CALLBACK = "0613451166"; //15 + 1 //--
          int iMESSAGE = 80 ; //--
          String MESSAGE = strSmsMsg; //strMsgText ; //80 + 1 //--
          int iEMPNO = 8 ; //--
          String EMPNO = strEmpNo ; // 8 + 1 //-- 
          int iREFCNT = 5 ; //
          String REFCNT = "00001"; // 5 + 1 //--
          int fCnt = 0 ; //--

          String SEND_MSG = null ; // --

          SEND_MSG = fillSpace(CLASSCODE, iCLASSCODE) + (char)0 ;
          SEND_MSG = SEND_MSG + fillSpace(PASSWORD, iPASSWORD) + (char)0 ;
          SEND_MSG = SEND_MSG + fillSpace(KEY, iKEY) + (char)0 ;
          SEND_MSG = SEND_MSG + fillSpace(RECVPHONE, iRECVPHONE) + (char)0 ;
          SEND_MSG = SEND_MSG + fillSpace(CALLBACK, iCALLBACK) + (char)0  ;

          if (fillSpace(MESSAGE,iMESSAGE).getBytes().length > iMESSAGE ){
                  if(MESSAGE.getBytes().length < iMESSAGE ){
                          fCnt = iMESSAGE-MESSAGE.getBytes().length;
                          MESSAGE = getMessage(MESSAGE,fCnt);
                  }
                  SEND_MSG = SEND_MSG + MESSAGE  + (char)0 ;
          }else{
                  SEND_MSG = SEND_MSG + fillSpace(MESSAGE,iMESSAGE) + (char)0 ;
          }

          SEND_MSG = SEND_MSG + fillSpace(EMPNO,iEMPNO)  + (char)0;
          SEND_MSG = SEND_MSG + fillSpace(REFCNT,iREFCNT )  + (char)0;

          return SEND_MSG;
  }

  public String rtnMessage(String MsgCode){
          String MsgStr = "" ;
          if (MsgCode.equals("2000")) {
                          MsgStr = "\uc778\uc99d\uc13c\ud130 \ubc1c\uc1a1 \ubaa8\ub4c8 \uc624\ub958";
          }else if (MsgCode.equals("9999")) {
                          MsgStr = "\uc131\uacf5";
          }else if (MsgCode.equals("1000")) {
                          MsgStr = "SMS \ud504\ub85c\uc138\uc2a4 \uc624\ub958(SMS \ub370\ubaac \ud504\ub85c\uc138\uc2a4 \uc815\uc9c0)";
          }else if (MsgCode.equals("1001")) {
                          MsgStr = "\uc804\uc1a1 \ub370\uc774\ud130\ud615\uc2dd \uc624\ub958";
          }else if (MsgCode.equals("1002")) {
                          MsgStr = "\uc11c\ubc84\uac04 \uc804\uc1a1\uc2dc\uac04 \ucd08\uacfc \uc624\ub958";
          }else if (MsgCode.equals("1100")) {
                          MsgStr = "\ub370\uc774\ud130\ubca0\uc774\uc2a4 \uc811\uc18d \uc624\ub958 \ub610\ub294 \ub3d9\uc2dc \uc811\uc18d \uacfc\ub2e4";
          }else if (MsgCode.equals("1101")) {
                          MsgStr = "\ub370\uc774\ud130\ubca0\uc774\uc2a4 Query \uc624\ub958";
          }else if (MsgCode.equals("1200")) {
                          MsgStr = "\uc0ac\uc5c5\uc18c \uc11c\ube44\uc2a4 \uc624\ub958 (\uc798\ubabb\ub41c \uc0ac\uc5c5\uc18c \ucf54\ub4dc \uc804\uc1a1)";
          }else if (MsgCode.equals("2000")) {
                          MsgStr = "\uc778\uc99d\uc13c\ud130 \ubc1c\uc1a1 \ubaa8\ub4c8 \uc624\ub958";
          }else {
                          MsgStr = "\uc131\uacf5";

          }
          return MsgStr ;

  }

  public String getRefUserPhone(String refUserId) {

          String refUserPhoneNum = null;

          try{
                  Context ictRef = new InitialContext();
                  DataSource dsRef = (DataSource) ictRef.lookup("java:comp/env/jdbc/USERS");
                  ResultSet rsRef = null;
                  Connection conRef = null;
                  Statement stmtRef = null;

                  String refQry = "" ;
                  refQry = refQry + "SELECT "; 
                  refQry = refQry + "             X.EMPNO ";
                  refQry = refQry + "     ,       X.USER_NAME ";
                  refQry = refQry + "     ,   X.CELLNO ";
                  refQry = refQry + "     ,       X.VAL1 ";
                  refQry = refQry + "     ,       X.VAL2 ";
                  refQry = refQry + "     ,( ";
                  refQry = refQry + "             CASE WHEN X.VAL1 = 'ok' THEN X.CELLNO ";
                  refQry = refQry + "             ELSE ";
                  refQry = refQry + "                     CASE WHEN X.VAL2 = 'ok' THEN  ";
                  refQry = refQry + "                             CASE WHEN LENGTH(X.CELLNO) = 10 THEN ";
                  refQry = refQry + "                                     SUBSTR(X.CELLNO,1,3) || '-' || SUBSTR(X.CELLNO,4,3) ";
                  refQry = refQry + "                                     || '-' || SUBSTR(X.CELLNO,7,4) ";
                  refQry = refQry + "                             ELSE ";
                  refQry = refQry + "                                     SUBSTR(X.CELLNO,1,3) || '-' || SUBSTR(X.CELLNO,4,4) ";
                  refQry = refQry + "                                     || '-' || SUBSTR(X.CELLNO,8,4) ";
                  refQry = refQry + "                             END ";
                  refQry = refQry + "                     ELSE 'x' ";
                  refQry = refQry + "                     END ";
                  refQry = refQry + "             END ";
                  refQry = refQry + "     ) AS PHONENUM ";
                  refQry = refQry + "     , X.MAILADDR ";
                  refQry = refQry + " FROM ( ";
                  refQry = refQry + "     SELECT ";
                  refQry = refQry + "             EMPNO ";
                  refQry = refQry + "             , NAME AS USER_NAME ";
                  refQry = refQry + "             , CELLNO ";
                  refQry = refQry + "             , DECODE ( ";
                  refQry = refQry + "                     REGEXP_REPLACE(  ";
                  refQry = refQry + "                             REGEXP_SUBSTR(  ";
                  refQry = refQry + "                                     CELLNO,  ";
                  refQry = refQry + "                                     '01[0-9]{1}-[0-9]{3,4}-[0-9]{4}',  ";
                  refQry = refQry + "                                     1 ";
                  refQry = refQry + "                             ), '[^0-9]', '-' ";
                  refQry = refQry + "                     )  ";
                  refQry = refQry + "             , '','x','ok') VAL1  ";
                  refQry = refQry + "             , DECODE ( ";
                  refQry = refQry + "                     REGEXP_REPLACE(  ";
                  refQry = refQry + "                             REGEXP_SUBSTR(  ";
                  refQry = refQry + "                                     CELLNO,  ";
                  refQry = refQry + "                                     '01[0-9]{1}[0-9]{7,8}',  ";
                  refQry = refQry + "                                     1 ";
                  refQry = refQry + "                             ), '[^0-9]', '-' ";
                  refQry = refQry + "                     )  ";
                  refQry = refQry + "             , '','x','ok') VAL2 ";
                  refQry = refQry + "    , MAILNO ";
                  refQry = refQry + "                      ,( ";
                  refQry = refQry + "    CASE WHEN MAILNO IS NULL THEN 'x' ";
                  refQry = refQry + "    ELSE ";
                  refQry = refQry + "             CASE INSTR(MAILNO,'@',1)  ";
                  refQry = refQry + "                     WHEN 0 THEN MAILNO || '@kepco.co.kr' ";
                  refQry = refQry + "       ELSE MAILNO ";
                  refQry = refQry + "       END ";
                  refQry = refQry + "     END ";
                  refQry = refQry + "    ) AS MAILADDR ";
                  refQry = refQry + "     FROM  V_INSA ";
                  refQry = refQry + "     WHERE EMPNO = '"+ refUserId +"' ";
                  refQry = refQry + ") X ";

                  conRef = dsRef.getConnection();
                  stmtRef = conRef.createStatement();
                  rsRef = stmtRef.executeQuery(refQry);

                  if (rsRef.next())       {
                          refUserPhoneNum = rsRef.getString("PHONENUM").replace("-","");
                  }

                  rsRef.close();
                  stmtRef.close();
                  conRef.close();

          }
          catch(Exception ex){
                          ex.printStackTrace();
          } finally {
          }
   
          return refUserPhoneNum;
  }

  
  public void
  _jspService(javax.servlet.http.HttpServletRequest request,
              javax.servlet.http.HttpServletResponse response)
    throws java.io.IOException, javax.servlet.ServletException
  {
    javax.servlet.http.HttpSession session = request.getSession(true);
    com.caucho.server.webapp.WebApp _jsp_application = _caucho_getApplication();
    com.caucho.jsp.PageContextImpl pageContext = _jsp_pageManager.allocatePageContext(this, _jsp_application, request, response, null, session, 8192, true, false);

    TagState _jsp_state = null;

    try {
      _jspService(request, response, pageContext, _jsp_application, session, _jsp_state);
    } catch (java.lang.Throwable _jsp_e) {
      pageContext.handlePageException(_jsp_e);
    } finally {
      _jsp_pageManager.freePageContext(pageContext);
    }
  }
  
  private void
  _jspService(javax.servlet.http.HttpServletRequest request,
              javax.servlet.http.HttpServletResponse response,
              com.caucho.jsp.PageContextImpl pageContext,
              javax.servlet.ServletContext application,
              javax.servlet.http.HttpSession session,
              TagState _jsp_state)
    throws Throwable
  {
    javax.servlet.jsp.JspWriter out = pageContext.getOut();
    final javax.el.ELContext _jsp_env = pageContext.getELContext();
    javax.servlet.ServletConfig config = getServletConfig();
    javax.servlet.Servlet page = this;
    javax.servlet.jsp.tagext.JspTag _jsp_parent_tag = null;
    com.caucho.jsp.PageContextImpl _jsp_parentContext = pageContext;
    response.setContentType("text/html;charset=EUC-KR");

    out.write(_jsp_string0, 0, _jsp_string0.length);
    
//2014.04.22 com.initech.IniRA.* \uc81c\uac70
//--@ page import="com.initech.IniRA.*" 

boolean is_smsChk = true;

String pwdSynURL = "http://mail.kepco.co.kr/Synk/Password.ashx";
String pwdSyncKey = "5ac1bb6d4172409089a7df3aa6ec91c2";
String pwdSyncDidx = "1";


boolean m_bDebug = true;
String m_How = null;

String m_IniErrCode = null;
String m_IniErrMsg = null;
IniPlugin m_IP = new IniPlugin(request, response, "/home/initech/iniplugin/properties/IniPlugin.inica70.properties");

//************************************************
//      Post Data \ud655\uc778
//************************************************
String INIdata = request.getParameter("INIpluginData");
if (INIdata == null)
{
	m_IniErrCode = "iniPlugin_101";
	m_IniErrMsg = "Exception : INIpluginData is null";
	System.out.println(m_IniErrMsg);
	//IniDebug.request(request);
}

if (m_IniErrCode == null) 
{
	try {
		m_IP.init();
	} catch(PrivateKeyDecryptException e) {
		m_IniErrCode = "PLUGIN_001";
		m_IniErrMsg = "Exception : " + e.getMessage();

	} catch(CRLFileNotFoundException e) {
		m_IniErrCode = "PLUGIN_002";
		m_IniErrMsg = "Exception : " + e.getMessage();
	} catch(PropertyFileNotFoundException e) {
		m_IniErrCode = "PLUGIN_003";
		m_IniErrMsg = "Exception : " + e.getMessage();
	} catch(PrivateKeyFileNotFoundException e) {
		m_IniErrCode = "PLUGIN_004";
		m_IniErrMsg = "Exception : " + e.getMessage();
	} catch(CACertFileNotFoundException e) {
		m_IniErrCode = "PLUGIN_005";
		m_IniErrMsg = "Exception : " + e.getMessage();
	} catch(INIpluginDataAbnormalFormatException e) {
		m_IniErrCode = "PLUGIN_006";
		m_IniErrMsg = "Exception : " + e.getMessage();
	} catch(LongParseException e) {
		m_IniErrCode = "PLUGIN_007";
		m_IniErrMsg = "Exception : " + e.getMessage();
	} catch(PrivateKeyParseException e) {
		m_IniErrCode = "PLUGIN_008";
		m_IniErrMsg = "Exception : " + e.getMessage();
	} catch(CRLFileParseException e) {
		m_IniErrCode = "PLUGIN_009";
		m_IniErrMsg = "Exception : " + e.getMessage();
	} catch(CACertFileParseException e) {
		m_IniErrCode = "PLUGIN_010";
		m_IniErrMsg = "Exception : " + e.getMessage();
	} catch(ClientCertParseException e) {
		m_IniErrCode = "PLUGIN_011";
		m_IniErrMsg = "Exception : " + e.getMessage();
	} catch(AbnormalPropertyFileException e) {
		m_IniErrCode = "PLUGIN_012";
		m_IniErrMsg = "Exception : " + e.getMessage();
	} catch(PropertyNotFoundException e) {
		m_IniErrCode = "PLUGIN_013";
		m_IniErrMsg = "Exception : " + e.getMessage();
	} catch(VerifyDataDecryptException e) {
		m_IniErrCode = "PLUGIN_014";
		m_IniErrMsg = "Exception : " + e.getMessage();
	} catch(AbnormalVerifyDataException e) {
		m_IniErrCode = "PLUGIN_015";
		m_IniErrMsg = "Exception : " + e.getMessage();
	} catch(ExpiredVerifyDataException e) {
		m_IniErrCode = "PLUGIN_016";
		m_IniErrMsg = "Exception : " + e.getMessage();
	} catch(ClientCertValidityException e) {
		m_IniErrCode = "PLUGIN_017";
		m_IniErrMsg = "Exception : " + e.getMessage();
	} catch(SignatureVerifyException e) {
		m_IniErrCode = "PLUGIN_018";
		m_IniErrMsg = "Exception : " + e.getMessage();
	} catch(ClientCertRevokedException e) {
		m_IniErrCode = "PLUGIN_019";
		m_IniErrMsg = "Exception : " + e.getMessage();
	} catch(SessionKeyException e) {
		m_IniErrCode = "PLUGIN_020";
		m_IniErrMsg = "Exception : " + e.getMessage();
	} catch(EncryptDataException e) {
		m_IniErrCode = "PLUGIN_021";
		m_IniErrMsg = "Exception : " + e.getMessage();
	} catch(DecryptDataException e) {
		m_IniErrCode = "PLUGIN_022";
		m_IniErrMsg = "Exception : " + e.getMessage();
	} catch(CRLFileIOException e) {
		m_IniErrCode = "PLUGIN_023";
		m_IniErrMsg = "Exception : " + e.getMessage();
	} catch(PropertyFileIOException e) {
		m_IniErrCode = "PLUGIN_024";
		m_IniErrMsg = "Exception : " + e.getMessage();
	} catch(PrivateKeyFileIOException e) {
		m_IniErrCode = "PLUGIN_025";
		m_IniErrMsg = "Exception : " + e.getMessage();
	} catch(CACertFileIOException e) {
		m_IniErrCode = "PLUGIN_026";
		m_IniErrMsg = "Exception : " + e.getMessage();
	} catch(PropertyFileParseException e) {
		m_IniErrCode = "PLUGIN_027";
		m_IniErrMsg = "Exception : " + e.getMessage();
	} catch(VerifyFlagException e) {
		m_IniErrCode = "PLUGIN_028";
		m_IniErrMsg = "Exception : " + e.getMessage();
	} catch(IOException e) {
		m_IniErrCode = "PLUGIN_029";
		m_IniErrMsg = "Exception : " + e.getMessage();
	} catch(SignDataException e) {
		m_IniErrCode = "PLUGIN_030";
		m_IniErrMsg = "Exception : " + e.getMessage();
	} catch(Exception e) {
		m_IniErrCode = "PLUGIN_099";
		m_IniErrMsg = "Exception : " + e.getMessage();
		e.printStackTrace();
	}

	//if (m_IniErrCode != null) IniDebug.request(request);
}

    out.write(_jsp_string1, 0, _jsp_string1.length);
     m_How = "certNew"; 
    out.write(_jsp_string1, 0, _jsp_string1.length);
    
//************************************************
//      \ubcc0\uc218 \uc120\uc5b8 \ubc0f \uc785\ub825\uc815\ubcf4 \ubcf5\ud638\ud654
//************************************************
	
response.setHeader("Cache-Control", "no-cache, post-check=0, pre-check=0");
response.setHeader("Pragma", "no-cache");
response.setHeader("Expires", "0");



//2014.04.22 \ub77c\uc774\uc13c\uc2a4\uacbd\ub85c \uc81c\uac70
//String licensePath = "/home/initech/iniplugin/license/IniRA_v6_sdk.lic";
//IniRAutil m_RA = new IniRAutil( licensePath );




//\uc554\ud638\ud654\uc5ec\ubd80 : \ub9ac\uc5bc\uc801\uc6a9\uc2dc \ubc18\ub4dc\uc2dctrue\ub85c \ubcc0\uacbd\ud574\uc57c\ud568..
boolean m_bEncrypt = true;

//\uc0ac\uc6a9\uc790\uc815\ubcf4\ub97c \uc778\uc0ac\uc815\ubcf4\uc5d0\uc11c \uac00\uc9c0\uace0 \uc640\uc11c
//\ud574\ub2f9 \uc0ac\uc6a9\uc790\ub9cc \uc778\uc99d\uc11c \ubc1c\uae09 \ubc1b\uac8c \ud560\uc9c0 \uccb4\ud06c
// false : \uc778\uc0ac\uc815\ubcf4\uc678 \uc785\ub825\ud55c \uc784\uc758\uc758 \uc544\uc774\ub514\ub85c\ub3c4 \ubc1c\uae09\uac00\ub2a5
//\ub9ac\uc5bc\uc801\uc6a9\uc2dc \ubc18\ub4dc\uc2dctrue\ub85c \ubcc0\uacbd\ud574\uc57c\ud568..
boolean is_insaUser = true;

//String userPwdSendURL = "http://10.


//\uc0ac\uc6a9\uc790 \uc2e0\ubd84\ud655\uc778 \uc815\ubcf4
String m_ID = null;		// form name = id
String m_REGNO = null;	// form name = regno
String m_pw = null; // form name = certpass

//SMS \uc778\uc99d\ucf54\ub4dc
//String m_smschk = null; //\ubc1c\uae09SMS\uc778\uc99d\ucf54\ub4dc
String m_sms = null; //\uc785\ub825SMS\uc778\uc99d\ucf54\ub4dc
String m_tmid = null;//SMS\uc778\uc99d\uc744 \uc704\ud55c \ud0c0\uc784 \uc544\uc774\ub514

//\ubc1c\uae09\uc2dc \uae30\uc874 \uc778\uc99d\uc11c \ud3d0\uae30 \ud6c4 \ub2e4\uc2dc \ubc1c\uae09\ud558\ub294 \ud504\ub85c\uc138\uc2a4 \uc635\uc158
String m_strBrg = null ;



// \uc870\ud68c \uc815\ubcf4 (\uc694\uccad)
String m_SEARCHCODE = null;		// form name = searchcode
String m_SEARCHCONTENTS = null;	// form name = searchcontents

// \uc870\ud68c \uc815\ubcf4 (\uc751\ub2f5)
String m_seCACODE			= null;
String m_seMANAGERID		= null;
String m_seCERTPOLICY		= null;
String m_seCERTSERIAL		= null;
String m_seUSERID			= null;
String m_seSUBJECTDN		= null;
String m_seIDNO				= null;
String m_seSVDATE			= null;
String m_seEVDATE			= null;
String m_seCERTSTATUS		= null;
String m_seTOTALRECORDNUM	= null;
String m_seCURRENTRECORNUM	= null;

//Challenge\uc0ac\uc6a9\uc5ec\ubd80 : \uc77c\ubc18\uc801\uc73c\ub85c \uc0ac\uc6a9\uc548\ud568
boolean m_bChallenge = false;

//LDAP \uad00\ub828\uc815\ubcf4 : \ubcc0\uacbd\ud558\uc9c0 \ub9d0\uac83
String m_certserial = null;
String m_ldapchallenge = null;

//\uc778\uc99d\uc11c\uc2e0\uccad\uc815\ubcf4, \ud638\uc2a4\ud2b8\uc5d0\uc11c \ubc1c\uc544\uc57c \ud560\uc815\ubcf4 : \ubcc0\uacbd\ud558\uc9c0 \ub9d0\uac83
String m_REQ = null; //cert request
String m_CN = "\ud64d\uae38\ub3d9";
String m_MAIL = "caadmin@kepco.co.kr";
String m_OU = "\uc815\ubcf4\uae30\uc220\ucc98";	//\uc815\ubcf4\uae30\uc220\ucc98
String m_O = "\ud55c\uad6d\uc804\ub825\uacf5\uc0ac";
String m_L = "\uc11c\uc6b8\ud2b9\ubcc4\uc2dc";
String m_C = "KR";

//\uc778\uc99d\uc11c \uc2e0\uccad(\ucde8\uc18c) \uc131\uacf5\uc2dc \ubc1b\uc544\uc624\ub294 \uac12\ub4e4 : \ubcc0\uacbd\ud558\uc9c0 \ub9d0\uac83
String m_caSerial = null;
String m_caSeqNo = null;
String m_caIssueDate = null;
String m_caExpireDate = null;
String m_caRevokeDate = null;
String m_caRejectReason = null;

//\ubc1c\uae09(\ud3d0\uae30)\ub41c \uc778\uc99d\uc11c\ub97c PC\uc5d0 \uc800\uc7a5(\uc0ad\uc81c)\ud558\uae30\uc704\ud55c \uc815\ubcf4 : \ubcc0\uacbd\ud558\uc9c0 \ub9d0\uac83
String m_caCertString = null;
String m_orgCertString = null;
String m_caRevokedCertString = null;


if (m_IniErrCode == null) {
	
	try {
		if (m_bDebug) System.out.println("INIplugin (" + m_How + " ) : start ip.init");

		//\uc0ac\uc6a9\uc790 \ud655\uc778 Parameter \uc785\ub825\ud3fc\uc774 \ucd94\uac00\ub418\uba74 \uc5ec\uae30\ub2e4\uac00 \ucd94\uac00\ud558\uba74 \ub428
		m_ID = m_IP.getParameter("id");

		//2014.04.22 \ud55c\uad6d\uc804\ub825\uc740 \uc8fc\ubbfc\ubc88\ud638 \uc785\ub825\ud558\uc9c0 \uc54a\uc73c\ubbc0\ub85c
		//\uc784\uc758\uc758 \uc8fc\ubbfc\ub4f1\ub85d \ubc88\ud638\ub97c \uc785\ub825\ud558\uac8c \ud55c\ub2e4.
		//m_REGNO = lpad(m_IP.getParameter("regno"),13, "0");
		m_REGNO = "0000000000000";

		//\uc0ac\uc6a9\uc790\ube44\ubc00\ubc88\ud638 \uad00\ub9ac\ub97c \uc704\ud574
		m_pw = m_IP.getParameter("pw");


		//m_smschk = m_IP.getParameter("smschk");
		m_sms = m_IP.getParameter("sms");
		m_tmid = m_IP.getParameter("tmid");

		m_strBrg = m_IP.getParameter("strBrg");

		m_SEARCHCODE = m_IP.getParameter("searchcode");
		m_SEARCHCONTENTS = m_IP.getParameter("searchcontents");
		
		if (m_How.equals("certNew") || m_How.equals("certRenewal") ||
			m_How.equals("certReplace")) {
			m_REQ = m_IP.getParameter("req");
			
			//CN\uac12\uc740 ID\ub85c \ubcc0\uacbd
			//m_CN = m_IP.getParameter("CN");
			m_CN = m_ID ;
			
			m_MAIL = m_IP.getParameter("EMAIL");
			
			//OU\uac12 \ubcc0\uacbd : \uc804\uc790\ud1b5\uc2e0\ucc98
			m_OU = m_IP.getParameter("OU");
			m_OU = "\uc815\ubcf4\uae30\uc220\ucc98"; //\uc815\ubcf4\uae30\uc220\ucc98
			
			//O\uac12 \ubcc0\uacbd : \ud55c\uad6d\uc804\ub825\uacf5\uc0ac
			//m_O = m_IP.getParameter("O");
			m_O = "\ud55c\uad6d\uc804\ub825\uacf5\uc0ac";
			
			
			m_L = m_IP.getParameter("L");

			//C\uac12 \ubcc0\uacbd : KR
			//m_C = m_IP.getParameter("C");
			m_C = "KR";
		}
		
		m_certserial = m_IP.getParameter("serialno");

		if (m_bDebug) {
			System.out.println("\tID : " + m_ID);
			System.out.println("\tREGNO : " + m_REGNO);
//			System.out.println("\tPW : " + m_PW);
			System.out.println("\tCN : " + m_CN);
			System.out.println("\tEMAIL : " + m_MAIL);
			System.out.println("\tSERIAL : " + m_certserial);			
			System.out.println("\tSEARCHCODE     : " + m_SEARCHCODE);			
			System.out.println("\tSEARCHCONTENTS : " + m_SEARCHCONTENTS);			
		}
		if (m_bDebug) System.out.println(m_ID + "( " + m_How + " ) : end ip.init");
	} catch(Exception e){
		m_IniErrCode = "iniPlugin_102";
		System.out.println(m_ID + " : Exception : " + e.getMessage());
		e.printStackTrace();
	}
}

    out.write(_jsp_string2, 0, _jsp_string2.length);
     
//*********************************************************
//  \uc0ac\uc6a9\uc790\uac00 \uc785\ub825\ud55c \uc544\uc774\ub514(\uc0ac\ubc88)\uc73c\ub85c \ubc1c\uae09\uc815\ubcf4\uac00 \uc788\ub294\uc9c0 \ud655\uc778
//*********************************************************


Context ict = new InitialContext();
DataSource ds = (DataSource) ict.lookup("java:comp/env/jdbc/INICA");
ResultSet rs = null;

Connection conn = null;
Statement stmt = null;

String isCert = "Y" ; //\ubc1c\uae09\uc720\ubb34
String CertGb = "\ubc1c\uae09" ;
int rsCnt = 0 ;

String certUserNm = "\ud14c\uc2a4\ud2b8\uc0ac\uc6a9\uc790";

String revokeCertString = null; //\ud3d0\uae30\ud574\uc57c\ud560 \uc778\uc99d\uc11c String \uac12

String userPwdCheck = "Y" ; //\uc774\uc804 \ud328\uc2a4\uc6cc\ub4dc \uccb4\ud06c \ud50c\ub798\uadf8

// printf("test");	
try {
	
	conn = ds.getConnection();
	//Creat Query and get results
	stmt = conn.createStatement();

	rs = stmt.executeQuery("select count(userid) as cnt from ldap_info where userid='" + m_ID + "' and status <> 'R' and expiredate >= sysdate ");
	//\uc0ac\uc6a9\uc790\uc544\uc774\ub514\ub85c \uce74\uc6b4\ud2b8\ud558\uc5ec 0\ubcf4\ub2e4 \ud06c\uba74 \uc7ac\ubc1c\uae09\ud558\uace0 0\uc774\uba74 \ubc1c\uae09
	
	while( rs.next() ) {
		rsCnt = rs.getInt("cnt");
	}
	
	if (rsCnt == 0){
		isCert = "N";
		CertGb = "\uc2e0\uaddc \ubc1c\uae09";
	}else{
		isCert = "Y";
		CertGb = "\uc7ac\ubc1c\uae09";
	}
	
} catch(Exception e) {
	e.printStackTrace();
} finally {
	rs.close();
	conn.close();
}

//\uc0ac\uc6a9\uc790\uc815\ubcf4\ub97c \uc778\uc0ac\uc815\ubcf4\uc5d0\uc11c \uac00\uc9c0\uace0 \uc640\uc11c
//\ud574\ub2f9 \uc0ac\uc6a9\uc790\ub9cc \uc778\uc99d\uc11c \ubc1c\uae09 \ubc1b\uac8c \ud560\uc9c0 \uccb4\ud06c
// false : \uc778\uc0ac\uc815\ubcf4\uc678 \uc785\ub825\ud55c \uc784\uc758\uc758 \uc544\uc774\ub514\ub85c\ub3c4 \ubc1c\uae09\uac00\ub2a5

if (is_insaUser) {
	Context insaIc = new InitialContext();
	DataSource insaDs = (DataSource) insaIc.lookup("java:comp/env/jdbc/USERS");
	ResultSet insaRs = null;

	Connection insaConn = null;
	Statement insaStmt = null;

	String m_userName = null;
	int userInsaCnt = 0 ;

	try{
		insaConn = insaDs.getConnection();
		//Creat Query and get results
		insaStmt = insaConn.createStatement();
		insaRs = insaStmt.executeQuery("SELECT count(*) as cnt FROM V_INSA where empno='" + m_ID + "' ");
		
		//List results
		while(insaRs.next()) {
			userInsaCnt =  insaRs.getInt("cnt");
		}

		if (userInsaCnt == 0){
			//\uc778\uc0acDB\uc5d0 \uc0ac\uc6a9\uc790 \uc815\ubcf4\uac00 \uc5c6\uc744 \ub54c
			//\uc785\ub825\ud558\uc2e0 \uc0ac\ubc88\uc5d0 \ub300\ud55c \uc815\ubcf4\uac00 \uc778\uc0ac\uc815\ubcf4\uc5d0\ub294 \uc874\uc7ac\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4.

			response.setCharacterEncoding("EUC-KR");
			PrintWriter writer = response.getWriter();
			writer.println("<script type='text/javascript'>");
			writer.println("alert('\uc785\ub825\ud558\uc2e0 \uc0ac\ubc88("+ m_ID +")\uc5d0 \ub300\ud55c \uc815\ubcf4\uac00 \uc778\uc0ac\uc815\ubcf4\uc5d0\ub294 \uc874\uc7ac\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4.');");
			writer.println("location.href='ini_certNew.jsp'");
		    writer.println("</script>");
			writer.flush();
			return;


		}else{
			insaRs = insaStmt.executeQuery("SELECT NAME as certUserNm FROM V_INSA where empno='" + m_ID + "' ");
			
			while(insaRs.next()) {
				certUserNm =  insaRs.getString("certUserNm");
			}
		}

	}
	catch(Exception ex){
		ex.printStackTrace();
	} finally {
		insaRs.close();
		insaConn.close();
	}

} // \uc778\uc0ac\uc815\ubcf4 \uccb4\ud06c \uc720\ubb34 end
else{
	certUserNm = "\ud14c\uc2a4\ud2b8\uc0ac\uc6a9\uc790";
}


//\uc778\uc99d\uc11c \ud3d0\uae30 \ud558\uae30
if (m_How.equals("certRevoke")) {
	//\uc778\uc99d\uc11c \ud3d0\uae30\ub97c \uc704\ud574 
	//Step1 : \ud3d0\uae30\ud560 \uc778\uc99d\uc11c\uac00 \uc788\ub294\uc9c0 \uccb4\ud06c\ud55c\ub2e4.
	//        LDAP_INFO\uc5d0\uc11c \uac80\uc0c9\ud558\uc5ec count\uac00 0\uc774\uba74 \ubc1c\uae09\ud398\uc774\uc9c0\ub85c
	//                               count\uac00 0\uc774\uc0c1\uc774\uba74 \ud3d0\uae30 \ud504\ub85c\uc138\uc2a4
	Context rvkIc = new InitialContext();
	DataSource rvkDs = (DataSource) rvkIc.lookup("java:comp/env/jdbc/INICA");
	ResultSet rvkRs = null;

	Connection rvkConn = null;
	Statement rvkStmt = null;

	int rvkCertCnt = 0 ;
	int rvkPwdUCnt = 0 ;
	String strSerial = null;

	try{
		rvkConn = rvkDs.getConnection();
		//Creat Query and get results
		rvkStmt = rvkConn.createStatement();


		//\uc778\uc99d\uc11c \ud3d0\uae30\ud558\uae30 \uc704\ud574 \ubc1c\uae09 \uc815\ubcf4\uac00 \uc874\uc7ac\ud558\ub294 \ud655\uc778 
		//\ubc1c\uae09\uc815\ubcf4\uac00 \uc788\uc73c\uba74 (count > 0) \ud3d0\uae30
		//\ubc1c\uae09\uc815\ubcf4\uac00 \uc5c6\uc73c\uba74 (count = 0) \ubc1c\uae09\ud398\uc774\uc9c0\ub85c

		rvkRs = rvkStmt.executeQuery("select count(userid) as cnt from ldap_info where userid='" + m_ID + "' ");
		
		//List results
		while(rvkRs.next()) {
			rvkCertCnt =  rvkRs.getInt("cnt");
		}

		if (rvkCertCnt == 0){
			//LDAP_INFO \uc778\uc99d\uc11c \uc815\ubcf4\uac00 \uc5c6\uc744 \ub54c
			//\ud3d0\uae30\ud574\uc57c\ud560 \uc778\uc99d\uc11c\uac00 \uc874\uc7ac\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4.
			if (m_strBrg.equals("Y")) { //\ubc1c\uae09\ud504\ub85c\uc138\uc2a4 \ubc14\ub85c \ucc98\ub9ac
			}else{	

				response.setCharacterEncoding("EUC-KR");
				PrintWriter writer = response.getWriter();
				writer.println("<script type='text/javascript'>");
				writer.println("alert('\uc785\ub825\ud558\uc2e0 \uc0ac\ubc88("+ m_ID +")\uc73c\ub85c \ud3d0\uae30\ud574\uc57c \ud560 \uc778\uc99d\uc11c\uac00 \uc874\uc7ac\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4.\uc778\uc99d\uc11c \ubc1c\uae09\ud398\uc774\uc9c0\uc5d0\uc11c \uc778\uc99d\uc11c\ub97c \ubc1c\uae09\ubc1b\uc544 \uc8fc\uc2ed\uc2dc\uc624');");
				writer.println("location.href='ini_certNew.jsp'");
				writer.println("</script>");
				writer.flush();
				return;
			}


		}else{ //\uc785\ub825\ubc1b\uc740 \uc544\uc774\ub514\uc640 \ube44\ubc00\ubc88\ud638\uc5d0 \ub300\ud55c \uc778\uc99d\uc11c \uc874\uc7ac
			rvkRs = rvkStmt.executeQuery("select serial from ldap_info where userid='" + m_ID + "' ");
			while(rvkRs.next()) {
				m_certserial =  rvkRs.getString("serial");
			}
			
		}
		
			
		//Step2 : \uc778\uc99d\uc11c \ubc1c\uae09\uc2dc \uae30\uc874 \ubc1c\uae09\uc815\ubcf4\uac00 \uc788\uc744\ub54c
		//        \ubc14\ub85c \ud3d0\uae30\ub97c \ud558\ub418 \uc774\ub54c\ub294 \ub530\ub85c \ube44\ubc88 \uccb4\ud06c\uc548\ud55c\ub2e4
		//Step2 : \uc785\ub825\ud55c \uc0ac\uc6a9\uc790\uc758 \uc0ac\ubc88\uacfc PWD\uac00 \uc874\uc7ac\ud558\ub294\uc9c0 \uccb4\ud06c\ud55c\ub2e4.
		//Step2 : \uc785\ub825\ud55c \uc0ac\uc6a9\uc790\uc758 \uc0ac\ubc88\uacfc PWD\uac00 \uc874\uc7ac\ud558\ub294\uc9c0 \uccb4\ud06c\ud55c\ub2e4.
				

		rvkRs = rvkStmt.executeQuery("select count(userid) as cnt from user_pwd where userid='" + m_ID + "' and userpwd = '" + getBase64Data(getHashValue(m_pw)) + "' ");
		
		//List results
		while(rvkRs.next()) {
			rvkPwdUCnt =  rvkRs.getInt("cnt");
		}

		if (m_strBrg.equals("Y")) {
		}else{		
			if (rvkPwdUCnt == 0){
				//LDAP_INFO \uc778\uc99d\uc11c \uc815\ubcf4\uac00 \uc5c6\uc744 \ub54c
				//\ud3d0\uae30\ud574\uc57c\ud560 \uc778\uc99d\uc11c\uac00 \uc874\uc7ac\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4.

				response.setCharacterEncoding("EUC-KR");
				PrintWriter writer = response.getWriter();
				writer.println("<script type='text/javascript'>");
				writer.println("alert('\uc778\uc99d\uc11c \ube44\ubc00\ubc88\ud638\uac00 \uc798\ubabb\ub418\uc5c8\uc2b5\ub2c8\ub2e4.');");
				writer.println("location.href='ini_certRevoke.jsp'");
				writer.println("</script>");
				writer.flush();
				return;
			}
		}

		

	}
	catch(Exception ex){
		ex.printStackTrace();
	} finally {
		rvkRs.close();
		rvkStmt.close();
		rvkConn.close();
	}
	
	//\ud074\ub77c\uc774\uc5b8\ud2b8 PC\uc758 \uc778\uc99d\uc11c\ub97c \uc0ad\uc81c\ud558\uae30 \uc704\ud574
	//CA CERT_INFO Table\uc5d0\uc11c \uc778\uc99d\uc11c String \uac12\uc744 \uac00\uc9c0\uace0 \uc624\uc790
	Context certIc = new InitialContext();
	DataSource certDs = (DataSource) certIc.lookup("java:comp/env/jdbc/INIRA");
	ResultSet certRs = null;

	Connection certConn = null;
	Statement certStmt = null;
	try{
		certConn = certDs.getConnection();
		//Creat Query and get results
		certStmt = certConn.createStatement();

		certRs = certStmt.executeQuery("SELECT CERTIFICATE FROM CERT_INFO WHERE SERIAL = '"+ m_certserial +"' ");
		
		while(certRs.next()) {
			revokeCertString =  certRs.getString("CERTIFICATE");
		}

	}
	catch(Exception ex){
		ex.printStackTrace();
	} finally {
		certRs.close();
		certStmt.close();
		certConn.close();
	}
	


}

//SMS\uc778\uc99d\uccb4\ud06c\ud558\uae30
if (m_How.equals("certNew")) { //\uc778\uc99d\uc11c \ubc1c\uae09\uc2dc\uc5d0\ub9cc \uccb4\ud06c\ud558\uc790
	if (is_smsChk) {
		String seq = m_tmid + "_" + m_ID + "_" + request.getRemoteAddr();
		String smsQry = "" ;
		smsQry = smsQry + "select count(x.smsnum) as cnt " ;
		smsQry = smsQry + "from ( " ;
		smsQry = smsQry + "	select a.smsnum " ;
		smsQry = smsQry + "	, rank() over (order by a.crdate desc) AS ranking " ;
		smsQry = smsQry + "	from sms_log a " ;
		smsQry = smsQry + "	where a.userid='"+ m_ID +"' " ;
		smsQry = smsQry + "		and a.userip = '"+ request.getRemoteAddr() +"' " ;
		smsQry = smsQry + "		and a.seq = '"+ seq +"' " ;
		smsQry = smsQry + "	order by a.crdate desc " ;
		smsQry = smsQry + ") x " ;
		smsQry = smsQry + " where x.ranking=1  and x.smsnum='"+ m_sms +"'" ;

		String delQry = "";
		delQry = "delete from sms_log " ;
		delQry = delQry + "	where userid='"+ m_ID +"' " ;
		delQry = delQry + "		and userip = '"+ request.getRemoteAddr() +"' " ;
		delQry = delQry + "		and seq = '"+ seq +"' " ;
		delQry = delQry + "		and smsnum = '"+ m_sms +"' " ;

		Context icsm = new InitialContext();
		DataSource dssm = (DataSource) icsm.lookup("java:comp/env/jdbc/INICA");
		ResultSet rss = null;
		Connection conns = null;
		Statement stmts = null;
		PreparedStatement pstmtsm = null;

		int rsSmsCnt = 0 ;

		try {
			conns = dssm.getConnection();
			stmts = conns.createStatement();

			rss = stmts.executeQuery(smsQry);
			//\uc0ac\uc6a9\uc790\uc544\uc774\ub514\ub85c \uce74\uc6b4\ud2b8\ud558\uc5ec 0\ubcf4\ub2e4 \ud06c\uba74 update 0\uc774\uba74 insert
			while( rss.next() ) {
				rsSmsCnt = rss.getInt("cnt");
			}
			
			if (rsSmsCnt == 0){
				response.setCharacterEncoding("EUC-KR");
				PrintWriter writer = response.getWriter();
				writer.println("<script type='text/javascript'>");
				writer.println("alert('\uc785\ub825\ud558\uc2e0 \uc778\uc99d\ubc88\ud638\ub294 \uc62c\ubc14\ub978 SMS\uc778\uc99d\ubc88\ud638\uac00 \uc544\ub2d9\ub2c8\ub2e4.\\n\ub2e4\uc2dc \ud55c\ubc88 \uc778\uc99d\uc11c \ubc1c\uae09\uc744 \ud558\uc2ed\uc2dc\uc624.');");
				writer.println("location.href='ini_certNew.jsp';");
				writer.println("</script>");
				writer.flush();
				return;


			}else{
				//\uc815\uc0c1\uc801\uc73c\ub85c \uc218\ud589\ud558\uba74 \uae30\uc874 \ub370\uc774\ud130\ub294 \uc0ad\uc81c\ud558\uc790.
				//pstmtsm = conns.prepareStatement(delQry);
				//pstmtsm.executeUpdate();

			}
			
		} catch(Exception e) {
			e.printStackTrace();
		} finally {
			rss.close();
			conns.close();
		}
	}
}


//\uc774\uc804 \ud328\uc2a4\uc6cc\ub4dc \uccb4\ud06c\uc720\ubb34
	
Context ictPwd = new InitialContext();
DataSource dsPwd = (DataSource) ictPwd.lookup("java:comp/env/jdbc/INICA");
ResultSet rsPwd = null;
Connection connPwd = null;
Statement stmtPwd = null;

String orgPWD = "";
String encryptPWD = "" ;

try {
	
	connPwd = dsPwd.getConnection();
	//Creat Query and get results
	stmtPwd = connPwd.createStatement();

	//-------------------------------------------
	// STEP 1 : \ub118\uc5b4\uc628 \uc0ac\ubc88\uc73c\ub85c \uc0ac\uc6a9\uc790\uac00 \uc874\uc7ac\ud558\ub294 \uc9c0 \uccb4\ud06c\ud558\ub2e4
	//-------------------------------------------    
	rsPwd = stmtPwd.executeQuery("SELECT USERPWD  FROM USER_PWD WHERE USERID = '"+ m_ID +"'");
	
	
	//-------------------------------------------
	// STEP 2 : \uc0ac\uc6a9\uc790\uac00 \uc874\uc7ac\ud55c\ub2e4\uba74
	//-------------------------------------------  
	if (rsPwd.next())     	{
		//-------------------------------------------
		// STEP 2-1 : \ub118\uc5b4\uc628 \ube44\ubc88\uc744 \uc554\ud638\ud654\ud55c\ub2e4
		//------------------------------------------- 
		encryptPWD = getBase64Data(getHashValue(m_pw));
		orgPWD = rsPwd.getString("USERPWD");			// USERPWD

		//-------------------------------------------
		// STEP 2-2 : \uc554\ud638\ud654\ud55c \ube44\ubc88\uacfc DB\uc5d0 \uc788\ub294 \ube44\ubc88\uc744 \ube44\uad50\ud55c\ub2e4
		//------------------------------------------- 
		if (encryptPWD.equals(orgPWD)) {
			//-------------------------------------------
			// STEP 2-3 : \ub450\uac1c\uac12\uc774 \uac19\ub2e4\uba74 N \ub9ac\ud134\ud558\uace0
			//------------------------------------------- 
			userPwdCheck = "N" ;
		}else{
			//-------------------------------------------
			// STEP 2-4 : \ub450\uac1c\uac12\uc774 \ub2e4\ub974\ub2e4\uba74 Y\ub97c \ub9ac\ud134\ud55c\ub2e4.
			//------------------------------------------- 
			userPwdCheck = "Y" ;
		}
	} else{
		//-------------------------------------------
		// STEP 3 : \uc0ac\uc6a9\uc790\uac00 \uc874\uc7ac\ud558\uc9c0 \uc54a\ub294\ub2e4\uba74 Y \ub85c \ub9ac\ud134\ud55c\ub2e4
		//-------------------------------------------    
		userPwdCheck = "Y" ;
	}
	
} catch(Exception e) {
	e.printStackTrace();
} finally {
	rsPwd.close();
	stmtPwd.close();
	connPwd.close();
}


    out.write(_jsp_string3, 0, _jsp_string3.length);
     if (m_IniErrCode == null) 
{
	String userid = m_ID;	
	String regno = m_REGNO;
	String ou = m_OU;
	//CN\uac12 \uc0ac\uc6a9\uc790 \uc544\uc774\ub514\ub85c \ubcc0\uacbd
	//String cn = m_CN;
	String cn = m_ID;

	String mail = m_MAIL;
	String policy = "71";
	String serialno = m_certserial;

	HashMap hash = null;

	//m_RA.setInfo(m_ID, m_IP);
	boolean ret = false;

	/* \uc694\uccad (C0:\ubc1c\uae09\uc694\uccad, C5:\uc7ac\ubc1c\uae09\uc694\uccad, C8:\uac31\uc2e0\uc694\uccad) */
	String CACode = null;
	if (m_How.equals("certNew")) 
	{
		CACode = "C0";
	}
	else if (m_How.equals("certReplace"))
	{
		CACode = "C5";
	}
	else if (m_How.equals("certRenewal"))
	{
		CACode = "C8";
	}
	else if (m_How.equals("certRevoke") || m_How.equals("certStop") || m_How.equals("certStart"))
	{
		CACode = "40";	/* 40:\uc778\uc99d\uc11c \uc0c1\ud0dc\ubcc0\uacbd \uc694\uccad */
	}
	else if (m_How.equals("certSearch"))
	{
		CACode = "50";	/* 50:\uc778\uc99d\uc11c \uc870\ud68c \uc694\uccad */
	}

	if (m_How.equals("certRevoke") || m_How.equals("certStop") || m_How.equals("certStart"))
	{
		String RAUSER = "TEST";					// \ub2e8\ub9d0\uae30 \uc6b4\uc601\uc790 ID
		String SERVICEPROVIDER = "01";			// \uc11c\ube44\uc2a4\uc81c\uacf5\uc790   01 RA_v7, 02 AuthGD
		String CODE = "08";						// \uc778\uc99d\uae30\uad00 \uc2dd\ubcc4\ucf54\ub4dc 01 \uae08\uacb0\uc6d0, 02 \ubb34\uc5ed\uc815\ubcf4\ud1b5\uc2e0, 03 \uc804\uc790\uc778\uc99d, 04 \ucf54\uc2a4\ucf64, 05 \uc815\ubcf4\uc778\uc99d, 06 \ud55c\uad6d\uc804\uc0b0\uc6d0, 08 \uc0ac\uc124CA
		String CERTPOLICY = policy;				// \uc778\uc99d\uc815\ucc45 \uc2dd\ubcc4\ucf54\ub4dc
		String CERTSERIAL = serialno;			// \uc778\uc99d\uc11c \uc77c\ub828\ubc88\ud638
		String SERVICECODE = null;
		if (m_How.equals("certRevoke"))
			SERVICECODE = "30";				// \uc11c\ube44\uc2a4 \ucf54\ub4dc 30:\ud3d0\uae30
		else if (m_How.equals("certStop"))
			SERVICECODE = "40";				// \uc11c\ube44\uc2a4 \ucf54\ub4dc 40:\ud6a8\ub825\uc815\uc9c0
		else if (m_How.equals("certStart"))
			SERVICECODE = "41";				// \uc11c\ube44\uc2a4 \ucf54\ub4dc 41:\ud6a8\ub825\ud68c\ubcf5

		hash = new HashMap();
		hash.put("MANAGERID", RAUSER);
		hash.put("SERVICEPROVIDER", SERVICEPROVIDER);
		hash.put("CACODE", CODE);
		hash.put("CERTCODE", CERTPOLICY);
		hash.put("CERTSERIAL", CERTSERIAL);
		hash.put("SERVICECODE", SERVICECODE);
	}
	else if (m_How.equals("certSearch"))
	{
		String RAUSER = "TEST";					// \ub2e8\ub9d0\uae30 \uc6b4\uc601\uc790 ID
		String SERVICEPROVIDER = "01";			// \uc11c\ube44\uc2a4\uc81c\uacf5\uc790   01 RA_v7, 02 AuthGD
		String CODE = "08";						// \uc778\uc99d\uae30\uad00 \uc2dd\ubcc4\ucf54\ub4dc 01 \uae08\uacb0\uc6d0, 02 \ubb34\uc5ed\uc815\ubcf4\ud1b5\uc2e0, 03 \uc804\uc790\uc778\uc99d, 04 \ucf54\uc2a4\ucf64, 05 \uc815\ubcf4\uc778\uc99d, 06 \ud55c\uad6d\uc804\uc0b0\uc6d0, 08 \uc0ac\uc124CA
		String CERTPOLICY = policy;				// \uc778\uc99d\uc815\ucc45 \uc2dd\ubcc4\ucf54\ub4dc
		String SEARCHCODE = m_SEARCHCODE;
		String SEARCHCONTENTS = m_SEARCHCONTENTS;
		String REQRECORDSTARTNO = null;
		String REQRECORDNO = null;

		hash = new HashMap();
		hash.put("MANAGERID", RAUSER);
		hash.put("SERVICEPROVIDER", SERVICEPROVIDER);
		hash.put("CACODE", CODE);
		hash.put("CERTCODE", CERTPOLICY);
		hash.put("SEARCHCODE", SEARCHCODE);
		hash.put("SEARCHCONTENTS", SEARCHCONTENTS);
		hash.put("REQRECORDSTARTNO", REQRECORDSTARTNO);
		hash.put("REQRECORDNO", REQRECORDNO);
	}
	else
	{
		String RAUSER = "TEST";					// \ub2e8\ub9d0\uae30 \uc6b4\uc601\uc790 ID
		String USERCODE = "1";					// \uac00\uc785\uc790 \uad6c\ubd84\ucf54\ub4dc  1 \uac1c\uc778, 2 \uae30\uc5c5, 3 \uae30\ud0c0
		String ORGNAME = ou;					// \uae30\uc5c5\uba85
		String DETAILNAME = cn;					// \uac1c\uc778/\uae30\uc5c5 \uc138\ubd80\uba85
		String REGNO = regno;					// \uc8fc\ubbfc\ubc88\ud638
		String BANKINGID = userid;				// \uc778\ud130\ub137\ubc45\ud0b9ID
		String SERVICEPROVIDER = "01";			// \uc11c\ube44\uc2a4\uc81c\uacf5\uc790   01 RA_v7, 02 AuthGD
		String CODE = "08";						// \uc778\uc99d\uae30\uad00 \uc2dd\ubcc4\ucf54\ub4dc 01 \uae08\uacb0\uc6d0, 02 \ubb34\uc5ed\uc815\ubcf4\ud1b5\uc2e0, 03 \uc804\uc790\uc778\uc99d, 04 \ucf54\uc2a4\ucf64, 05 \uc815\ubcf4\uc778\uc99d, 06 \ud55c\uad6d\uc804\uc0b0\uc6d0, 08 \uc0ac\uc124CA
		String CERTPOLICY = policy;				// \uc778\uc99d\uc815\ucc45 \uc2dd\ubcc4\ucf54\ub4dc
		String USERMAIL = mail;	// \uc774\uba54\uc77c
		String PHONE = "010-123-1234";			// \ud3f0
		String FAX = "02-6445-7200";			// FAX
		String POSTNUM = "123-123";				// \uc6b0\ud3b8\ubc88\ud638
		String ADDRESS ="\uc11c\uc6b8 \uad6c\ub85c \uad6c\ub85c\ub3d9 \uc5d0\uc774\uc2a4\ud558\uc774\uc5d4\ub4dc\ud0c0\uc6cc2\ucc28 11\uce35 1\ud638"; // \uc8fc\uc18c
		String PKCS10MSG = m_REQ;

		hash = new HashMap();
		hash.put("MANAGERID", RAUSER);
		hash.put("USERCODE", USERCODE);
		hash.put("OU_NAME", ORGNAME);
		hash.put("CN_NAME", DETAILNAME);
		hash.put("IDNO", REGNO);
		hash.put("USERID", BANKINGID);
		hash.put("SERVICEPROVIDER", SERVICEPROVIDER);
		hash.put("CACODE", CODE);
		hash.put("CERTCODE", CERTPOLICY);
		hash.put("EMAIL", USERMAIL);
		hash.put("HANDPHONE", PHONE);
		hash.put("FAX", FAX);
		hash.put("POSTCODE", POSTNUM);
		hash.put("POSTADDR", ADDRESS);
		hash.put("PHONE", PHONE);
		hash.put("POSTCODE1", POSTNUM);
		hash.put("POSTADDR1", ADDRESS);
		hash.put("PHONE1", PHONE);
		hash.put("PKCS10MSG", PKCS10MSG);
	}

	/* RA SDK \ucd08\uae30\ud654 */
	//IniOPPRA iniRA = new IniOPPRA("172.20.25.121", 4007);
	IniOPPRA iniRA = new IniOPPRA("10.180.2.66", 4000);
	iniRA.setCharEncoding("euc-kr");
	/* IniOPPRA iniRA = new IniOPPRA("172.20.25.140", 4007); */
	iniRA.initialize();

	/* RA \uc694\uccad */
	OppraSendDataParser oppraSendDataParser = new OppraSendDataParser(CACode, hash, false);
	String requestMsg = oppraSendDataParser.getSendLastData();

	/* \uc751\ub2f5\uc218\uc2e0 [PKCS#10 \uc778\uc99d\uc11c \ubc1c\uae09\ud1b5\ubcf4 (C1) \ud3ec\ub9f7] */
	/* [\uc815\uc0c1\uc751\ub2f5: rescode=000]
	 * 01: RESLEN
	 * 02: RESCODE
	 * 03: RESMSG
	 * 04: CERTDATA (\uc0c1\ud0dc\ubcc0\uacbd \uba54\uc2dc\uc9c0 \uc694\uccad\uc758 \uc751\ub2f5\uc77c \uacbd\uc6b0 \uc81c\uc678) */
	/* [\uc624\ub958\uc751\ub2f5: rescode=999]
	 * 01: RESLEN
	 * 02: RESCODE
	 * 03: RESMSG
	 * 04: ADDRESCODE
	 * 05: ADDRESMSG
	 * 06: RESERVE1
	 * 07: RESERVE2 */
	/* [\uc624\ub958\uc751\ub2f5: rescode=\uae30\ud0c0]
	 * 01: RESLEN
	 * 02: RESCODE
	 * 03: RESMSG
	 * 04: ADDRESCODE
	 * 05: ADDRESMSG
	 * 06: RESERVE1
	 * 07: RESERVE2
	 * 08: RESERVE3
	 * 09: RESERVE4 */
	String rsp = iniRA.requestRAW(requestMsg);
	OppraMessageDataParser odp = new OppraMessageDataParser(CACode, iniRA.getResDataPart());
	String sRESLEN = odp.getCodeData("RESLEN");			// \ub808\ucf54\ub4dc\uae38\uc774
	String sRESCODE = odp.getCodeData("RESCODE");		// \uc751\ub2f5\ucf54\ub4dc
	String sRESMSG = odp.getCodeData("RESMSG");			// \uc751\ub2f5\uba54\uc138\uc9c0
	String sCERTDATA = null;
	String sADDRESCODE = null;
	String sADDRESMSG = null;
	String sRESERVE1 = null;
	String sRESERVE2 = null;
	String sRESERVE3 = null;
	String sRESERVE4 = null;
	String sCLICERTDATA = null;

	String sCACODE = null;
	String sMANAGERID = null;
	String sCERTPOLICY = null;
	String sCERTSERIAL = null;
	String sUSERID = null;
	String sSUBJECTDN = null;
	String sIDNO = null;
	String sSVDATE = null;
	String sEVDATE = null;
	String sCERTSTATUS = null;
	String sTOTALRECORDNUM = null;
	String sCURRENTRECORNUM = null;

	if (sRESCODE.equals("000"))
	{
		if (m_How.equals("certRevoke") || m_How.equals("certStop") || m_How.equals("certStart"))
		{
			if (m_bDebug)
			{
				System.out.println(m_ID + "( " + m_How + " ) - \ub514\ubc84\uadf80(\uc804\uccb4)       : " + iniRA.getResDataPart());
				System.out.println(m_ID + "( " + m_How + " ) - \ub514\ubc84\uadf81(\ub808\ucf54\ub4dc\uae38\uc774) : " + sRESLEN);
				System.out.println(m_ID + "( " + m_How + " ) - \ub514\ubc84\uadf82(\uc751\ub2f5\ucf54\ub4dc)   : " + sRESCODE);
				System.out.println(m_ID + "( " + m_How + " ) - \ub514\ubc84\uadf83(\uc751\ub2f5\uba54\uc138\uc9c0) : " + sRESMSG);
			}
		}
		else if (m_How.equals("certSearch"))
		{
			sCACODE = odp.getStrCodeData("CACODE");						// \ub4f1\ub85d\ub300\ud589 \uae30\uad00\ucf54\ub4dc
			sMANAGERID = odp.getStrCodeData("MANAGERID");				// \ub2e8\ub9d0\uae30 \uc6b4\uc601\uc790 ID
			sCERTPOLICY = odp.getStrCodeData("CERTPOLICY");				// \uc778\uc99d\uc815\ucc45\uc2dd\ubcc4\ucf54\ub4dc
			sCERTSERIAL = odp.getStrCodeData("CERTSERIAL");				// \uc778\uc99d\uc11c\uc77c\ub828\ubc88\ud638
			sUSERID = odp.getStrCodeData("USERID");						// \uac00\uc785\uc790ID
			sSUBJECTDN = odp.getStrCodeData("SUBJECTDN");				// \uac00\uc785\uc790 DN\uba85
			sIDNO = odp.getStrCodeData("IDNO");							// \uc8fc\ubbfc(\uc0ac\uc5c5\uc790)\ub4f1\ub85d\ubc88\ud638
			sSVDATE = odp.getStrCodeData("SVDATE");						// \uc720\ud6a8\uae30\uac04\uc2dc\uc791
			sEVDATE = odp.getStrCodeData("EVDATE");						// \uc720\ud6a8\uae30\uac04\uc885\ub8cc
			sCERTSTATUS = odp.getStrCodeData("CERTSTATUS");				// \uc778\uc99d\uc11c\uc0c1\ud0dc
			sTOTALRECORDNUM= odp.getStrCodeData("TOTALRECORDNUM");		// \ucd1d \ub808\ucf54\ub4dc \uc218
			sCURRENTRECORNUM= odp.getStrCodeData("CURRENTRECORNUM");	// \ud604 \ub808\ucf54\ub4dc \ubc88\ud638

			if (m_bDebug)
			{
				System.out.println(m_ID + "( " + m_How + " ) - \ub514\ubc84\uadf800(\uc804\uccb4)       : " + iniRA.getResDataPart());
				System.out.println(m_ID + "( " + m_How + " ) - \ub514\ubc84\uadf801(\ub808\ucf54\ub4dc\uae38\uc774) : " + sRESLEN);
				System.out.println(m_ID + "( " + m_How + " ) - \ub514\ubc84\uadf802(\uc751\ub2f5\ucf54\ub4dc)   : " + sRESCODE);
				System.out.println(m_ID + "( " + m_How + " ) - \ub514\ubc84\uadf803(\uc751\ub2f5\uba54\uc138\uc9c0) : " + sRESMSG);
				System.out.println(m_ID + "( " + m_How + " ) - \ub514\ubc84\uadf804(\ub4f1\ub85d\ub300\ud589 \uae30\uad00\ucf54\ub4dc)    : " + sCACODE);
				System.out.println(m_ID + "( " + m_How + " ) - \ub514\ubc84\uadf805(\ub2e8\ub9d0\uae30 \uc6b4\uc601\uc790 ID)     : " + sMANAGERID);
				System.out.println(m_ID + "( " + m_How + " ) - \ub514\ubc84\uadf806(\uc778\uc99d\uc815\ucc45\uc2dd\ubcc4\ucf54\ub4dc)     : " + sCERTPOLICY);
				System.out.println(m_ID + "( " + m_How + " ) - \ub514\ubc84\uadf807(\uc778\uc99d\uc11c\uc77c\ub828\ubc88\ud638)       : " + sCERTSERIAL);
				System.out.println(m_ID + "( " + m_How + " ) - \ub514\ubc84\uadf808(\uac00\uc785\uc790ID)             : " + sUSERID);
				System.out.println(m_ID + "( " + m_How + " ) - \ub514\ubc84\uadf809(\uac00\uc785\uc790 DN\uba85)          : " + sSUBJECTDN);
				System.out.println(m_ID + "( " + m_How + " ) - \ub514\ubc84\uadf810(\uc8fc\ubbfc(\uc0ac\uc5c5\uc790)\ub4f1\ub85d\ubc88\ud638) : " + sIDNO);
				System.out.println(m_ID + "( " + m_How + " ) - \ub514\ubc84\uadf811(\uc720\ud6a8\uae30\uac04\uc2dc\uc791)         : " + sSVDATE);
				System.out.println(m_ID + "( " + m_How + " ) - \ub514\ubc84\uadf812(\uc720\ud6a8\uae30\uac04\uc885\ub8cc)         : " + sEVDATE);
				System.out.println(m_ID + "( " + m_How + " ) - \ub514\ubc84\uadf813(\uc778\uc99d\uc11c\uc0c1\ud0dc)           : " + sCERTSTATUS);
				System.out.println(m_ID + "( " + m_How + " ) - \ub514\ubc84\uadf814(\ucd1d \ub808\ucf54\ub4dc \uc218)         : " + sTOTALRECORDNUM);
				System.out.println(m_ID + "( " + m_How + " ) - \ub514\ubc84\uadf815(\ud604 \ub808\ucf54\ub4dc \ubc88\ud638)       : " + sCURRENTRECORNUM);
			}
		}
		else
		{
			sCERTDATA = odp.getStrCodeData("CERTDATA");	// \uc778\uc99d\uc11c
			m_orgCertString = makeCertCSString(sCERTDATA);
			/* \uc778\uc99d\uc11c (\ud074\ub77c\uc774\uc5b8\ud2b8 \uc804\ub2ec \ud3ec\ub9f7) */
			sCLICERTDATA = makeCertString("UserCert", sCERTDATA, false);

			if (m_bDebug)
			{
				System.out.println(m_ID + "( " + m_How + " ) - \ub514\ubc84\uadf80(\uc804\uccb4)       : " + iniRA.getResDataPart());
				System.out.println(m_ID + "( " + m_How + " ) - \ub514\ubc84\uadf81(\ub808\ucf54\ub4dc\uae38\uc774) : " + sRESLEN);
				System.out.println(m_ID + "( " + m_How + " ) - \ub514\ubc84\uadf82(\uc751\ub2f5\ucf54\ub4dc)   : " + sRESCODE);
				System.out.println(m_ID + "( " + m_How + " ) - \ub514\ubc84\uadf83(\uc751\ub2f5\uba54\uc138\uc9c0) : " + sRESMSG);
				System.out.println(m_ID + "( " + m_How + " ) - \ub514\ubc84\uadf84(\uc778\uc99d\uc11c)     : " + sCERTDATA);
				System.out.println(m_ID + "( " + m_How + " ) - \ub514\ubc84\uadf85(\uc778\uc99d\uc11c-\ud074\ub77c\uc774\uc5b8\ud2b8\uc804\ub2ec\ud3ec\ub9f7) : " + sCLICERTDATA);
			}
		}
	}
	else if (sRESCODE.equals("999"))
	{
		sADDRESCODE = odp.getStrCodeData("ADDRESCODE");
		sADDRESMSG = odp.getStrCodeData("ADDRESMSG");
		sRESERVE1 = odp.getStrCodeData("RESERVE1");
		sRESERVE2 = odp.getStrCodeData("RESERVE2");

		if (m_bDebug)
		{
			System.out.println(m_ID + "( " + m_How + " ) - \ub514\ubc84\uadf80(\uc804\uccb4)       : " + iniRA.getResDataPart());
			System.out.println(m_ID + "( " + m_How + " ) - \ub514\ubc84\uadf81(\ub808\ucf54\ub4dc\uae38\uc774) : " + sRESLEN);
			System.out.println(m_ID + "( " + m_How + " ) - \ub514\ubc84\uadf82(\uc751\ub2f5\ucf54\ub4dc)   : " + sRESCODE);
			System.out.println(m_ID + "( " + m_How + " ) - \ub514\ubc84\uadf83(\uc751\ub2f5\uba54\uc138\uc9c0) : " + sRESMSG);
			System.out.println(m_ID + "( " + m_How + " ) - \ub514\ubc84\uadf84(ADDRESCODE) : " + sADDRESCODE);
			System.out.println(m_ID + "( " + m_How + " ) - \ub514\ubc84\uadf85(ADDRESMSG)  : " + sADDRESMSG);
			System.out.println(m_ID + "( " + m_How + " ) - \ub514\ubc84\uadf86(RESERVE1)   : " + sRESERVE1);
			System.out.println(m_ID + "( " + m_How + " ) - \ub514\ubc84\uadf87(RESERVE2)   : " + sRESERVE2);
		}
	}
	else
	{
		sADDRESCODE = odp.getStrCodeData("ADDRESCODE");
		sADDRESMSG = odp.getStrCodeData("ADDRESMSG");
		sRESERVE1 = odp.getStrCodeData("RESERVE1");
		sRESERVE2 = odp.getStrCodeData("RESERVE2");
		sRESERVE3 = odp.getStrCodeData("RESERVE3");
		sRESERVE4 = odp.getStrCodeData("RESERVE4");

		if (m_bDebug)
		{
			System.out.println(m_ID + "( " + m_How + " ) - \ub514\ubc84\uadf80(\uc804\uccb4)       : " + iniRA.getResDataPart());
			System.out.println(m_ID + "( " + m_How + " ) - \ub514\ubc84\uadf81(\ub808\ucf54\ub4dc\uae38\uc774) : " + sRESLEN);
			System.out.println(m_ID + "( " + m_How + " ) - \ub514\ubc84\uadf82(\uc751\ub2f5\ucf54\ub4dc)   : " + sRESCODE);
			System.out.println(m_ID + "( " + m_How + " ) - \ub514\ubc84\uadf83(\uc751\ub2f5\uba54\uc138\uc9c0) : " + sRESMSG);
			System.out.println(m_ID + "( " + m_How + " ) - \ub514\ubc84\uadf84(ADDRESCODE) : " + sADDRESCODE);
			System.out.println(m_ID + "( " + m_How + " ) - \ub514\ubc84\uadf85(ADDRESMSG)  : " + sADDRESMSG);
			System.out.println(m_ID + "( " + m_How + " ) - \ub514\ubc84\uadf86(RESERVE1)   : " + sRESERVE1);
			System.out.println(m_ID + "( " + m_How + " ) - \ub514\ubc84\uadf87(RESERVE2)   : " + sRESERVE2);
			System.out.println(m_ID + "( " + m_How + " ) - \ub514\ubc84\uadf88(RESERVE3)   : " + sRESERVE3);
			System.out.println(m_ID + "( " + m_How + " ) - \ub514\ubc84\uadf89(RESERVE4)   : " + sRESERVE4);
		}
	}

	if (sRESCODE.equals("000"))
	{
		if (m_How.equals("certNew") || m_How.equals("certRenewal") || m_How.equals("certReplace"))
		{
			/***********************************/
			/* \uc218\uc2e0\ub41c \uc778\uc99d\uc11c \ud074\ub77c\uc774\uc5b8\ud2b8\ub85c \uc804\ub2ec */
			/***********************************/
			m_caCertString = sCLICERTDATA;
		}
		else if (m_How.equals("certSearch"))
		{
			/***********************************/
			/* \uc870\ud68c\ub41c \uacb0\uacfc\ub97c \ud074\ub77c\uc774\uc5b8\ud2b8\ub85c \uc804\ub2ec */
			/***********************************/
			m_seCACODE			= sCACODE;			// \ub4f1\ub85d\ub300\ud589 \uae30\uad00\ucf54\ub4dc
			m_seMANAGERID		= sMANAGERID;		// \ub2e8\ub9d0\uae30 \uc6b4\uc601\uc790 ID
			m_seCERTPOLICY		= sCERTPOLICY;		// \uc778\uc99d\uc815\ucc45\uc2dd\ubcc4\ucf54\ub4dc
			m_seCERTSERIAL		= sCERTSERIAL;		// \uc778\uc99d\uc11c\uc77c\ub828\ubc88\ud638
			m_seUSERID			= sUSERID;			// \uac00\uc785\uc790ID
			m_seSUBJECTDN		= sSUBJECTDN;		// \uac00\uc785\uc790 DN\uba85
			m_seIDNO			= sIDNO;			// \uc8fc\ubbfc(\uc0ac\uc5c5\uc790)\ub4f1\ub85d\ubc88\ud638
			m_seSVDATE			= sSVDATE;			// \uc720\ud6a8\uae30\uac04\uc2dc\uc791
			m_seEVDATE			= sEVDATE;			// \uc720\ud6a8\uae30\uac04\uc885\ub8cc
			m_seCERTSTATUS		= sCERTSTATUS;		// \uc778\uc99d\uc11c\uc0c1\ud0dc
			m_seTOTALRECORDNUM	= sTOTALRECORDNUM;	// \ucd1d \ub808\ucf54\ub4dc \uc218
			m_seCURRENTRECORNUM	= sCURRENTRECORNUM;	// \ud604 \ub808\ucf54\ub4dc \ubc88\ud638
		}
	}
	else
	{
		/*************/
		/* \uc624\ub958 \uc751\ub2f5 */
		/*************/
		m_IniErrCode = sRESCODE;
	}

	/* THE END */
}

    out.write(_jsp_string4, 0, _jsp_string4.length);
    
	if (m_IniErrCode == null) {
		if (m_bDebug) System.out.println(m_ID + "( " + m_How + " ) *** Success ***\n");
	} else {
		if (m_bDebug) System.out.println(m_ID + "( " + m_How + " ) *** Fail : " + m_IniErrCode + " ***\n");
		response.sendRedirect("err.jsp?id=" + m_ID + "&how=" + m_How + "&code=" + m_IniErrCode + "&msg=" + m_IniErrMsg);
		return;
	}

    out.write(_jsp_string5, 0, _jsp_string5.length);
    
//\uc778\uc99d\uc11c \ubc1c\uae09\uc774 \uc815\uc0c1\uc801\uc73c\ub85c \uc774\ub8e8\uc5b4\uc84c\ub2e4\uba74 
//RA\ucabd USER_PWD \ud14c\uc774\ube14\uc5d0 \uc0ac\uc6a9\uc790\uc758 \ube44\ubc00\ubc88\ud638\ub97c \uc785\ub825 \ub610\ub294 \uc5c5\ub370\uc774\ud2b8 \ud574\uc8fc\uc790!

Context icu = new InitialContext();
DataSource dsu = (DataSource) icu.lookup("java:comp/env/jdbc/INICA");
ResultSet rsu = null;

Connection connu = null;
Statement stmtu = null;
PreparedStatement pstmtu = null;


String isPwd = "Y" ; //\ube44\ubc00\ubc88\ud638 \ub4f1\ub85d \uc720\ubb34
int rsPwdCnt = 0 ;
String insertSQL = null;

String seq = m_tmid + "_" + m_ID + "_" + request.getRemoteAddr();


// \uc778\uc99d\uc11c \ubc1c\uae09 \ud6c4 SMS\ubc1c\uc1a1 
// \uc778\uc99d\uc11c \ubc1c\uae09 \ud6c4 SMS\ubc1c\uc1a1 
String smsFlag = "N";
smsFlag = sendSMS(m_How, m_ID, m_tmid);


String delQry = "";
		delQry = "delete from sms_log " ;
		delQry = delQry + "	where userid='"+ m_ID +"' " ;
		delQry = delQry + "		and userip = '"+ request.getRemoteAddr() +"' " ;
		delQry = delQry + "		and seq = '"+ seq +"' " ;
		delQry = delQry + "		and smsnum = '"+ m_sms +"' " ;

try {
	connu = dsu.getConnection();
	//Creat Query and get results
	stmtu = connu.createStatement();

	rsu = stmtu.executeQuery("select count(userid) as cnt from user_pwd where userid='" + m_ID + "' ");
	//\uc0ac\uc6a9\uc790\uc544\uc774\ub514\ub85c \uce74\uc6b4\ud2b8\ud558\uc5ec 0\ubcf4\ub2e4 \ud06c\uba74 update 0\uc774\uba74 insert
	while( rsu.next() ) {
		rsPwdCnt = rsu.getInt("cnt");
	}
	
	if (rsPwdCnt == 0){
		//Inset
		insertSQL = "INSERT INTO USER_PWD (USERID, USERPWD,USERNAME, USERIP) VALUES ( '" + m_ID + "', '" + getBase64Data(getHashValue(m_pw)) + "' , '" + certUserNm + "', '" + request.getRemoteAddr() + "')";
		pstmtu = connu.prepareStatement(insertSQL);
		pstmtu.executeUpdate();


	}else{
		//update
		insertSQL = "UPDATE USER_PWD set USERPWD = '" + getBase64Data(getHashValue(m_pw)) + "' , USERNAME= '" + certUserNm + "', MDDATE=SYSDATE, USERIP = '"+ request.getRemoteAddr() +"' WHERE USERID = '" + m_ID + "'";
		pstmtu = connu.prepareStatement(insertSQL);
		pstmtu.executeUpdate();
	}

	//SMS\uc778\uc99d \uc815\ubcf4 \uc0ad\uc81c
	//pstmtu = connu.prepareStatement(delQry);
	//pstmtu.executeUpdate();

	//[STR] VPN \uc5f0\uacc4\ub97c \uc704\ud55c \uc778\uc99d\uc11c \ubc1c\uae09 \uc544\uc774\ub514\uc815\ubcf4 \uc800\uc7a5 2017-04-11
	// \uae30\uc874\uc815\ubcf4 \uc0ad\uc81c
	pstmtu = connu.prepareStatement("DELETE FROM sync_pwd_vpn WHERE userid = '" + m_ID + "'");
	pstmtu.executeUpdate();

	// \ucd5c\uc2e0\uc815\ubcf4 \ub4f1\ub85d
	pstmtu = connu.prepareStatement("INSERT INTO sync_pwd_vpn (userid, cdate) VALUES('" + m_ID + "', SYSDATE)");
	pstmtu.executeUpdate();
	//[END] VPN \uc5f0\uacc4\ub97c \uc704\ud55c \uc778\uc99d\uc11c \ubc1c\uae09 \uc544\uc774\ub514\uc815\ubcf4 \uc800\uc7a5 2017-04-11

} catch(Exception e) {
	e.printStackTrace();
} finally {
	rsu.close();
	connu.close();
}

    out.write(_jsp_string1, 0, _jsp_string1.length);
    
/** 
[STR] VPN \uc0ac\uc6a9\uc790 \ube44\ubc00\ubc88\ud638 \uc5f0\uacc4\ubc29\uc2dd \ubcc0\uacbd REAL \u2192 BATCH 2017-04-20
	// VPN \uc0ac\uc6a9\uc790 \ud328\uc2a4\uc6cc\ub4dc \uc5c5\ub370\uc774\ud2b8 \ub0b4\uc6a9
     URL url;//URL \uc8fc\uc18c \uac1d\uccb4
        URLConnection connection;//URL\uc811\uc18d\uc744 \uac00\uc9c0\ub294 \uac1d\uccb4
        InputStream is;//URL\uc811\uc18d\uc5d0\uc11c \ub0b4\uc6a9\uc744 \uc77d\uae30\uc704\ud55c Stream
        InputStreamReader isr;
        BufferedReader br;

        try{
            //URL\uac1d\uccb4\ub97c \uc0dd\uc131\ud558\uace0 \ud574\ub2f9 URL\ub85c \uc811\uc18d\ud55c\ub2e4..
            url = new URL("http://10.180.6.97:8080/SSL/EMPLOYEE2/epi_relay.php?id="+m_ID+"&pw="+getBase64Data(getHashValue(m_pw)));
            connection = url.openConnection();

            //\ub0b4\uc6a9\uc744 \uc77d\uc5b4\uc624\uae30\uc704\ud55c InputStream\uac1d\uccb4\ub97c \uc0dd\uc131\ud55c\ub2e4..
            is = connection.getInputStream();
            isr = new InputStreamReader(is);
            br = new BufferedReader(isr);

            //\ub0b4\uc6a9\uc744 \uc77d\uc5b4\uc11c \ud654\uba74\uc5d0 \ucd9c\ub825\ud55c\ub2e4..
            String buf = null;
            while(true){
                buf = br.readLine();
                if(buf == null) break;
                System.out.println(buf);
            }
        }catch(MalformedURLException mue){
            System.err.println("\uc798\ubabb\ub418 URL\uc785\ub2c8\ub2e4. \uc0ac\uc6a9\ubc95 : java URLConn http://hostname/path]");
            System.exit(1);
        }catch(IOException ioe){
            System.err.println("IOException " + ioe);
            ioe.printStackTrace();
            System.exit(1);
        }
[END] VPN \uc0ac\uc6a9\uc790 \ube44\ubc00\ubc88\ud638 \uc5f0\uacc4\ubc29\uc2dd \ubcc0\uacbd REAL \u2192 BATCH 2017-04-20
**/

    out.write(_jsp_string6, 0, _jsp_string6.length);
    out.print((m_caCertString));
    out.write(_jsp_string7, 0, _jsp_string7.length);
     try { if (m_bEncrypt) out = m_IP.startEncrypt(out); } catch(Exception e) {} 
    out.write(_jsp_string8, 0, _jsp_string8.length);
    out.print((pwdSynURL));
    out.write(_jsp_string9, 0, _jsp_string9.length);
    out.print((pwdSyncKey));
    out.write(_jsp_string10, 0, _jsp_string10.length);
    out.print((pwdSyncDidx));
    out.write(_jsp_string11, 0, _jsp_string11.length);
    out.print((m_ID));
    out.write(_jsp_string12, 0, _jsp_string12.length);
    out.print((getBase64Data(getHashValue(m_pw))));
    out.write(_jsp_string13, 0, _jsp_string13.length);
    out.print((m_tmid));
    out.write(_jsp_string14, 0, _jsp_string14.length);
    out.print((certUserNm));
    out.write('(');
    out.print((m_ID));
    out.write(_jsp_string15, 0, _jsp_string15.length);
     try { if (m_bEncrypt) out = m_IP.endEncrypt(out); } catch(Exception e) {} 
    out.write(_jsp_string16, 0, _jsp_string16.length);
  }

  private com.caucho.make.DependencyContainer _caucho_depends
    = new com.caucho.make.DependencyContainer();

  public java.util.ArrayList<com.caucho.vfs.Dependency> _caucho_getDependList()
  {
    return _caucho_depends.getDependencies();
  }

  public void _caucho_addDepend(com.caucho.vfs.PersistentDependency depend)
  {
    super._caucho_addDepend(depend);
    _caucho_depends.add(depend);
  }

  protected void _caucho_setNeverModified(boolean isNotModified)
  {
    _caucho_isNotModified = true;
  }

  public boolean _caucho_isModified()
  {
    if (_caucho_isDead)
      return true;

    if (_caucho_isNotModified)
      return false;

    if (com.caucho.server.util.CauchoSystem.getVersionId() != -1257324557874484737L)
      return true;

    return _caucho_depends.isModified();
  }

  public long _caucho_lastModified()
  {
    return 0;
  }

  public void destroy()
  {
      _caucho_isDead = true;
      super.destroy();
    TagState tagState;
  }

  public void init(com.caucho.vfs.Path appDir)
    throws javax.servlet.ServletException
  {
    com.caucho.vfs.Path resinHome = com.caucho.server.util.CauchoSystem.getResinHome();
    com.caucho.vfs.MergePath mergePath = new com.caucho.vfs.MergePath();
    mergePath.addMergePath(appDir);
    mergePath.addMergePath(resinHome);
    com.caucho.loader.DynamicClassLoader loader;
    loader = (com.caucho.loader.DynamicClassLoader) getClass().getClassLoader();
    String resourcePath = loader.getResourcePathSpecificFirst();
    mergePath.addClassPath(resourcePath);
    com.caucho.vfs.Depend depend;
    depend = new com.caucho.vfs.Depend(appDir.lookup("certcenter64/inica70new/ini_certNew_send.jsp"), -1629986758120296850L, true);
    _caucho_depends.add(depend);
    depend = new com.caucho.vfs.Depend(appDir.lookup("certcenter64/inica70new/import/iniplugin_init.jsp"), -8960418715910081368L, true);
    _caucho_depends.add(depend);
    depend = new com.caucho.vfs.Depend(appDir.lookup("certcenter64/inica70new/import/inica70_init.jsp"), -7759514701566643355L, true);
    _caucho_depends.add(depend);
    depend = new com.caucho.vfs.Depend(appDir.lookup("certcenter64/inica70new/import/inica70_userSet.jsp"), 4497630937315889300L, true);
    _caucho_depends.add(depend);
    depend = new com.caucho.vfs.Depend(appDir.lookup("certcenter64/inica70new/import/inica70_ca_send.jsp"), 3322387933915330306L, true);
    _caucho_depends.add(depend);
    depend = new com.caucho.vfs.Depend(appDir.lookup("certcenter64/inica70new/import/inica70_err_check.jsp"), 7889382124300349123L, true);
    _caucho_depends.add(depend);
    depend = new com.caucho.vfs.Depend(appDir.lookup("certcenter64/inica70new/import/fncSMS.jsp"), 220014041040549546L, true);
    _caucho_depends.add(depend);
  }

  final static class TagState {

    void release()
    {
    }
  }

  public java.util.HashMap<String,java.lang.reflect.Method> _caucho_getFunctionMap()
  {
    return _jsp_functionMap;
  }

  public void caucho_init(ServletConfig config)
  {
    try {
      com.caucho.server.webapp.WebApp webApp
        = (com.caucho.server.webapp.WebApp) config.getServletContext();
      init(config);
      if (com.caucho.jsp.JspManager.getCheckInterval() >= 0)
        _caucho_depends.setCheckInterval(com.caucho.jsp.JspManager.getCheckInterval());
      _jsp_pageManager = webApp.getJspApplicationContext().getPageManager();
      com.caucho.jsp.TaglibManager manager = webApp.getJspApplicationContext().getTaglibManager();
      com.caucho.jsp.PageContextImpl pageContext = new com.caucho.jsp.InitPageContextImpl(webApp, this);
    } catch (Exception e) {
      throw com.caucho.config.ConfigException.create(e);
    }
  }

  private final static char []_jsp_string14;
  private final static char []_jsp_string15;
  private final static char []_jsp_string5;
  private final static char []_jsp_string9;
  private final static char []_jsp_string12;
  private final static char []_jsp_string11;
  private final static char []_jsp_string8;
  private final static char []_jsp_string4;
  private final static char []_jsp_string10;
  private final static char []_jsp_string1;
  private final static char []_jsp_string3;
  private final static char []_jsp_string13;
  private final static char []_jsp_string2;
  private final static char []_jsp_string16;
  private final static char []_jsp_string6;
  private final static char []_jsp_string0;
  private final static char []_jsp_string7;
  static {
    _jsp_string14 = "-->\n	<script language=\"javascript\">dspMainMenu();</script>\n	<!-- MAIN MENU END -->\n</div>\n\n<div style=\"height:10px;\"></div>\n<div id=\"subtop\">\n	<ul class=\"subtoptxt\">\n		<li class=\"toptxtcon\">\uc778\uc99d\uc13c\ud130 \uc774\uc6a9\ud558\uae30</li>\n		<li class=\"toptxtcon01\" style=\"text-decoration:underline;\">\uc778\uc99d\uc11c \ubc1c\uae09</li>\n		<li class=\"toptxtcon01\">\uc778\uc99d\uc11c \ud3d0\uae30</li>\n		<li class=\"toptxtcon01\">\uc778\uc99d\uc11c \uad00\ub9ac</li>\n	</ul>\n</div>\n\n<div id=\"subissue\">\n	<ul>\n		<li><img src=\"img/subtitle0101.gif\" alt=\"\uc778\uc99d\uc11c\ubc1c\uae09_\uc778\uc99d\uc11c\ub97c \ubc1c\uae09\ud574\ub4dc\ub9bd\ub2c8\ub2e4.\"></li>\n		<li class=\"stitle\"><img src=\"img/subtitle0203.gif\" alt=\"\uc778\uc99d\uc11c\ubc1c\uae09_\uc644\ub8cc\"></li>\n		<li class=\"box\">\n			<ul>\n				<li class=\"sbtextbg2\">\n					<img src=\"img/bullet_list.gif\" align=\"center\"> <b class=\"txblue\">".toCharArray();
    _jsp_string15 = ")</b> \ub2d8\uc758 \uc778\uc99d\uc11c\uac00 \uc131\uacf5\uc801\uc73c\ub85c \ubc1c\uae09\ub418\uc5c8\uc2b5\ub2c8\ub2e4.</li>\n				<li class=\"sbtextbg2\">\n					<img src=\"img/bullet_list.gif\" align=\"center\"> \uc778\uc99d\uc11c\uc758 \uc720\ud6a8\uae30\uac04\uc740 3\uac1c\uc6d4\uc774\uba70, \uc720\ud6a8\uae30\uac04\uc774 \uc9c0\ub09c \uc778\uc99d\uc11c\ub294 \uc0ac\uc6a9\ud558\uc2e4 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.</li>\n				<li class=\"sbtextbg2\">\n					<img src=\"img/bullet_list.gif\" align=\"center\"> PowerNet \ub85c\uadf8\uc778\uc744 \uc704\ud574\uc11c PowerNet ToolBand\uc758 \ud1b5\ud569\uc778\uc99d\uc744 \ud074\ub9ad\ud558\uc2ed\uc2dc\uc624. \uc774\uc6a9\ud574\uc8fc\uc154\uc11c \uac10\uc0ac\ud569\ub2c8\ub2e4</li>\n				<li class=\"dotted1\"></li>\n\n				<li class=\"sbtextbg\"> \n					- \uc778\uc99d\uc11c \ubd84\uc2e4(\uc778\uc99d\uc11c \ube44\ubc00\ubc88\ud638\ub97c \uc78a\uc5b4\ubc84\ub9b0 \uacbd\uc6b0, \uc774\uc6a9\ud558\ub294 \ucef4\ud4e8\ud130\uac00 \ubcc0\uacbd \ub41c \uacbd\uc6b0, \uc778\uc99d\uc11c\uac00 \uc0ad\uc81c\ub41c \uacbd\uc6b0 \ub4f1)\uc2dc \uc778\uc99d\uc11c\ub97c \ud3d0\uae30\ud55c \ud6c4, \ubc1c\uae09\ubc1b\uc73c\uc2dc\uba74 \uc0ac\uc6a9 \uac00\ub2a5\ud569\ub2c8\ub2e4. </li>\n				\n				<li style=\"text-align:center;\"><a href=\"/initech/certcenter64/inica70/index.jsp\"><img src=\"img/btn_cen_fir.gif\" alt=\"\uc778\uc99d\uc11c\ucd08\uae30\ud654\uba74\"></a></li>\n				\n			</ul>\n		</li>\n		\n	</ul>\n	<div style=\"height:90px;\"></div>\n</div>\n\n<!-- COPYRIGHT START -->\n<script language=\"javascript\">dspCopyRight();</script>\n<!-- COPYRIGHT END -->\n\n\n".toCharArray();
    _jsp_string5 = "\n\n \n\n\n\n\n\n\n\n\n".toCharArray();
    _jsp_string9 = "\">\n<input type=\"hidden\" name=\"key\" id=\"key\" value=\"".toCharArray();
    _jsp_string12 = "\" />\n<input type=\"hidden\" name=\"pwd\" id=\"pwd\" value=\"".toCharArray();
    _jsp_string11 = "\" />\n<input type=\"hidden\" name=\"usb\" id=\"usb\" value=\"".toCharArray();
    _jsp_string8 = "\n<iframe name=\"hdnFrame\" id=\"hdnFrame\" src=\"_balnk\" width=\"110\" height=\"110\" style=\"display:none\" scrolling=\"no\" frameborder=\"0\"></iframe>\n<form name=\"hdnForm\" id=\"hdnForm\" method=\"get\" action=\"".toCharArray();
    _jsp_string4 = "\n\n\r\n\r\n".toCharArray();
    _jsp_string10 = "\" />\n<input type=\"hidden\" name=\"didx\" id=\"didx\" value=\"".toCharArray();
    _jsp_string1 = "\n\n".toCharArray();
    _jsp_string3 = "	\r\n\r\n\r\n\n\n\n\n\n\n\n\n".toCharArray();
    _jsp_string13 = "\" />\n</form>\n<div id=\"header\"> \n	<!-- MAIN MENU START ".toCharArray();
    _jsp_string2 = "\n\n\n\n\r\n \r\n\r\n\r\n\r\n".toCharArray();
    _jsp_string16 = "\n\n</body>\n</html>\n\n".toCharArray();
    _jsp_string6 = "\n\n\n<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\n<head>\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=euc-kr\" />\n<title>\uc778\uc99d\uc13c\ud130 \uc774\uc6a9\uc548\ub0b4</title>\n<link rel=\"stylesheet\" type=\"text/css\" href=\"css/import.css\" />\n<link rel=\"stylesheet\" type=\"text/css\" href=\"css/main.css\" />\n\n<script type=\"text/javascript\" src=\"js/jquery-1.7.2.min.js\"></script>\n<script type=\"text/javascript\" src=\"js/jquery.flexslider-min.js\"></script>\n<script type=\"text/javascript\" src=\"js/jquery.als-1.1.min.js\"></script>\n<script type=\"text/javascript\" src=\"js/common.js\"></script>\n\n<script language=\"javascript\" src=\"/initech/plugin/INIplugin.js\"></script>\n<script language=\"javascript\">\n	var UserCert;\n	".toCharArray();
    _jsp_string0 = "\n\n\n\n\n\n\n\n\n\n\n".toCharArray();
    _jsp_string7 = "\n</script>\n<script language=\"javascript\">\nfunction setTimerMain() {\n	setTimeout(\"location.href='/initech/certcenter64/inica70/index.jsp'\",5000);\n}\n</script>\n\n<!--[if IE 6]>\n<link rel=\"stylesheet\" type=\"text/css\" href=\"css/ie6.css\">\n<![endif]-->\n<!--[if IE 7]>\n<link rel=\"stylesheet\" type=\"text/css\" href=\"css/ie7.css\">\n<![endif]-->\n</head> \n\n<body onload=\"InsertUserCert(UserCert);document.hdnForm.target='hdnFrame';document.hdnForm.submit(); setTimerMain();\">\n".toCharArray();
  }
}
